window.jdoo=window.jdoo||{},function(){String.prototype.t=function(){return this+""},Array.prototype.remove=function(e){let t=this.indexOf(e);t>-1&&this.splice(t,1)};let e=0;jdoo.nextId=function(){return e++},jdoo.emptyFn=function(){},jdoo.utils={apply:function(){let e,t,o,n,i,s,r=arguments[0]||{},c=1,l=arguments.length,d=!1;for("boolean"==typeof r&&(d=r,r=arguments[1]||{},c=2),"object"==typeof r||jQuery.isFunction(r)||(r={}),l===c&&(r=this,--c);c<l;c++)if(null!=(e=arguments[c]))for(t in e)t&&"$"===t[0]||(o=r[t],n=e[t],r!==n&&(d&&n&&(jQuery.isPlainObject(n)||(i=jQuery.isArray(n)))?(i?(i=!1,s=o&&jQuery.isArray(o)?jQuery.extend(d,[],o):[]):s=o&&jQuery.isPlainObject(o)?jQuery.extend(d,{},o):{},r[t]=jQuery.extend(d,s,n)):void 0!==n&&(n instanceof Function?jdoo.utils.defineMethod(r,t,n):r[t]=n)));return r},defineMethod:function(e,t,o){o.$owner&&(o=function(e){let t,o;for(o in t=function(){return e.apply(this,arguments)},e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}(o)),e[t]=o,o.$name=t,o.$owner=e.$class},parseXML:function(e){if(void 0===$.browser)if(navigator.userAgent.match(/Trident\/7\./)){let t=new ActiveXObject("Microsoft.XMLDOM");t.async="false",t.loadXML(e)}else{let t=new DOMParser;xmlDoc=t.parseFromString(e,"text/xml")}else if($.browser.msie)xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async="false",xmlDoc.loadXML(e);else{let t=new DOMParser;xmlDoc=t.parseFromString(e,"text/xml")}return $(xmlDoc)},randomId:function(){let e="";for(let t=1;t<=16;t++)e+=Math.floor(16*Math.random()).toString(16);return e}},jdoo.web={getUrlParam:function(e){let t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(t);return null!=o?unescape(o[2]):null},getParams:function(e){let t,o={},n=/([^&=]+)=([^&]*)/g;for(;t=n.exec(e);)o[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return o},getTenantPath:function(){return"/"+window.location.pathname.substring(1).split("/")[0]},cookie:function(e,t,o){if(void 0===t){let t=null;if(document.cookie&&""!=document.cookie){let o=document.cookie.split(";");for(let n=0;n<o.length;n++){let i=jQuery.trim(o[n]);if(i.substring(0,e.length+1)==e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}}return t}{o=o||{},null===t&&(t="",(o=$.extend({},o)).expires=-1);let n="";if(o.expires&&("number"==typeof o.expires||o.expires.toUTCString)){let e;"number"==typeof o.expires?(e=new Date,e.setTime(e.getTime()+24*o.expires*60*60*1e3)):e=o.expires,n="; expires="+e.toUTCString()}let i=o.path?"; path="+o.path:"",s=o.domain?"; domain="+o.domain:"",r=o.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),n,i,s,r].join("")}}},jdoo.rpc=function(e){let t=(e=e||{}).model,o=e.method,n=e.context||{},i=e.args||{},s=e.dialog,r={url:jdoo.web.getTenantPath()+"/rpc/service?module="+(e.module||"base"),type:"POST",dataType:"json",data:{id:jdoo.utils.randomId(),jsonrpc:"2.0",method:o,params:{args:i,context:n,model:t}},onsuccess:function(e){},onerror:function(e){s&&s.busy(!1),jdoo.msg.error(e)},success:function(e){if(e.error)c.onerror(e.error),7100===e.error.code&&top.window.location.reload();else{let t=e.result;c.onsuccess(t),s&&(s.busy(!1),jdoo.msg.show(s.submitText+"成功".t()))}},error:function(e){console.log(e)}};delete e.context,delete e.args,delete e.module,delete e.method,delete e.model,delete e.dialog;let c=$.extend(!0,r,e);c.data=JSON.stringify(c.data),$.ajax(c)},jdoo.msg={show:function(e,t){$(document).Toasts("create",$.extend({class:"msg bg-success",position:"bottomRight",title:"成功".t(),icon:"iconfont icon-check-circle",autohide:!0,delay:2e3,body:`<div style="min-width:200px">${e}</div>`},t))},error:function(e,t){if(1e3===e.code)$(document).Toasts("create",$.extend({class:"msg bg-danger",title:"验证不通过".t(),icon:"iconfont icon-exclamation-circle",autohide:!0,delay:5e3,body:`<div style="min-width:200px">${e.message}</div>`},t));else{console.error(e);let o=`<div style="min-width:200px">${e.message}</div>`;-1==[1020,7102,7110].indexOf(e.code)&&(o+=`<div>${(e.data||{}).debug}</div>`),$(document).Toasts("create",$.extend({class:"msg bg-danger",title:"发生错误".t(),body:o},t))}},confirm:function(e){let t=$.extend({title:"确认".t(),content:"",cancalButton:`<button class="btn btn-default cancel">${"取消".t()}</button>`,submitButton:`<button class="btn btn-default submit">${"确认".t()}</button>`,submit:jdoo.emptyFn,cancel:jdoo.emptyFn},e),o=`<div class="confirm-module">\n                        <div class="confirm-mask"></div>\n                        <div class="confirm">\n                            <div class="confirm-header">${t.title}</div>\n                            <div class="confirm-body">${t.content}</div>\n                            <div class="confirm-footer">\n                                ${t.cancalButton}\n                                ${t.submitButton}\n                            </div>\n                        </div>\n                    </div>`;$("body").append(o),$(".cancel").on("click",(()=>{t.cancel(),$(".confirm-module").remove()})),$(".submit").on("click",(()=>{t.submit(),$(".confirm-module").remove()}))}},jdoo.types={},jdoo.define=function(e,t){let o=function(){this.new(...arguments)},n=o.prototype,i=function(t){let i=jdoo.types[t];if(!i)throw new Error(e+" 不能扩展未定义的 "+t);o.$bases.push(i),jdoo.utils.apply(!0,n,i.prototype),jdoo.utils.apply(!0,o.$statics,i.$statics)};if(n.$class=o,o.$statics={},"function"==typeof t&&(t=t()),t=t||{},jdoo.utils.defineMethod(n,"new",(function(){})),o.$bases=[],"string"==typeof t.extends)i(t.extends);else if(jQuery.isArray(t.extends))for(let e=t.extends.length-1;e>=0;e--){let o=t.extends[e];"string"==typeof o&&i(o)}return t.statics&&(jdoo.utils.apply(!0,o.$statics,t.statics),delete t.statics),jdoo.utils.apply(!0,o,o.$statics),jdoo.utils.apply(!0,n,t),n.callSuper=function(){let e=this.$class.$bases,t=(new Error).stack.split("\n")[2].trim().split(/\s+/)[1].trim().split("."),o=t[t.length-1];for(let t=e.length-1;t>=0;t--){let n=e[t].prototype[o];if(n)return n.apply(this,arguments)}},o.$name=e,jdoo.types[e]=o,o},jdoo.override=function(e,t){let o=jdoo.types[e];return"function"==typeof t&&(t=t()),t.statics&&(jdoo.utils.apply(!0,o.$statics,t.statics),delete t.statics),jdoo.utils.apply(!0,o,o.$statics),jdoo.utils.apply(!0,o.prototype,t),o},jdoo.create=function(){let e=arguments[0],t=[];for(let e=1;e<arguments.length;e++)t.push(arguments[e]);return new jdoo.types[e](...t)}}();