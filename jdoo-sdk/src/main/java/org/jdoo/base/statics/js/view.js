(()=>{var __webpack_modules__={716:()=>{jdoo.column("boolean",{render:function(){return function(e,t,n){return e?'<label class="checked-column"></label>':'<label class="unchecked-column" ></label>'}}})},376:()=>{jdoo.columns={},jdoo.column=function(e,t){jdoo.columns[e]=jdoo.component("columns."+e,t)},jdoo.column("default",{render:function(){let e=this.field.type;return function(t,n,i){return null===t&&(t=""),"integer"===e||"float"===e?'<div class="text-right">'+t+"</div>":t}}})},590:()=>{jdoo.column("many2many",{render:function(){return function(e,t,n){return e}}})},934:()=>{jdoo.column("many2one",{render:function(){return function(e,t,n){return e&&e[0]?`<span data-value="${e[0]}">${e[1]}</span>`:""}}})},570:()=>{jdoo.column("selection",{render:function(){let e=this;return function(t,n,i){let a=e.field.options[t];return void 0===a&&(a=""),`<span data-value="${t}">${a}</span>`}}})},663:()=>{jdoo.editor("binary",{getTpl:function(){return`<div class="input-group">\n                    <div class="custom-file">\n                        <input type="file" class="custom-file-input" id="exampleInputFile"/>\n                        <label class="custom-file-label" for="exampleInputFile">${"选择文件...".t()}</label>\n                    </div>\n                    <div class="input-group-prepend">\n                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">\n                            Action\n                        </button>\n                        <ul class="dropdown-menu">\n                            <li class="dropdown-item"><a href="#">Action</a></li>\n                            <li class="dropdown-item"><a href="#">Another action</a></li>\n                            <li class="dropdown-item"><a href="#">Something else here</a></li>\n                            <li class="dropdown-divider"></li>\n                            <li class="dropdown-item"><a href="#">Separated link</a></li>\n                        </ul>\n                    </div>\n                </div>`},init:function(){var me=this,dom=me.dom,field=me.field;me.name=me.name||dom.attr("data-field")||field.name,me.trim=eval(me.trim||el.attr("trim")||field.trim),me.length=eval(me.length||el.attr("length")||field.length),dom.html(me.getTpl()).find("input[type=file]").on("change",(function(){let e=this.files[0];if(e){dom.find(".custom-file-label").text(e.name);let t=new FileReader;t.readAsDataURL(e),t.onload=function(t){me.data={file_name:e.name,data:this.result}}}}))},onValueChange:function(t){let n=this;n.dom.find("input[type=file]").on("change",(function(){t(e,n)}))},setReadonly:function(e){},getValue:function(){return this.data},setValue:function(e){console.log(e);let t=this.dom;t.find(".custom-file-label").text(e),e&&(t.find(".button_download").show(),t.find(".button_remove").show())}})},161:()=>{jdoo.editor("boolean",{css:"custom-switch custom-control",getTpl:function(){let e=this.name+"-"+jdoo.nextId();return`<input type="checkbox" class="custom-control-input" id="${e}"/><label for="${e}" class="custom-control-label mt-1"></label>`},getAllowNullTpl:function(){return`<select class="form-control" id="${this.name+"-"+jdoo.nextId()}">\n                    <option value=""></option>\n                    <option value="true">${"是".t()}</option>\n                    <option value="false">${"否".t()}</option>\n                </select>`},init:function(){let e=this,t=e.dom,n=e.field;e.name=e.name||t.attr("data-field")||n.name,e.allowNull?t.html(e.getAllowNullTpl()):t.addClass(e.css).append(e.getTpl())},onValueChange:function(e){let t=this;t.dom.find("select,input").on("change",(function(n){e(n,t)}))},setReadonly:function(e){let t=this,n=t.allowNull?"select":"input";e?t.dom.children(n).attr("disabled",!0):t.dom.children(n).removeAttr("disabled")},getValue:function(){let e=this;if(e.allowNull){let t=e.dom.children("select").val();return"true"===t||"false"!==t&&null}return e.dom.children("input").is(":checked")},setValue:function(v){let me=this;if("string"==typeof v&&v.length>0&&(v=Boolean(eval(v))),me.allowNull){let e=null==v||""===v?"":v?"true":"false";return me.dom.children("select").val(e)}me.dom.children("input").prop("checked",!0===v)}}),jdoo.searchEditor("boolean",{extends:"editors.boolean",allowNull:!0,getCriteria:function(){let e=this.getValue();return null!=e?[[this.name,"=",e]]:[]},getText:function(){let e=this;if(e.allowNull){let t=e.dom.children("select").val();return"true"===t?"是".t():"false"===t?"否".t():""}return e.dom.children("input").is(":checked")?"是".t():"否".t()}})},546:()=>{jdoo.editor("char",{getTpl:function(){return`<input type="text" class="form-control" id="${this.name+"-"+jdoo.nextId()}"/>`},init:function(){let me=this,dom=me.dom,field=me.field;me.name=me.name||dom.attr("data-field")||field.name,me.trim=eval(me.trim||dom.attr("trim")||field.trim),me.length=eval(me.length||dom.attr("length")||field.length),dom.html(me.getTpl())},onValueChange:function(e){let t=this;t.dom.find("input").on("change",(function(n){e(n,t)}))},setReadonly:function(e){e?this.dom.children("input").attr("readonly",!0):this.dom.children("input").removeAttr("readonly")},getValue:function(){var e=this.dom.children("input").val();return this.trim&&(e=e.trim()),e},setValue:function(e){this.dom.children("input").val(e)},valid:function(){var e=this.getValue();if(e.length>this.length)return"当前长度".t()+e.length+"超过最大长度".t()+this.length}}),jdoo.searchEditor("char",{extends:"editors.char",getCriteria:function(){var e=this.getValue(),t=e.split(";");return t.length>1?[[this.name,"in",t]]:e?[[this.name,"like",e]]:[]},getText:function(){return this.getValue()}})},639:()=>{jdoo.editor("date",{format:"YYYY-MM-DD",max:"2100-12-31",min:"1920-1-1",todayBtn:!0,sideBySide:!0,getTpl:function(){let e=this.name+"-"+jdoo.nextId();return`<div class="input-group date-edit" id="${e}" data-target-input="nearest">\n                    <input type="text" class="form-control datetimepicker-input" data-target="#${e}" />\n                    <div class="input-group-append" data-target="#${e}" data-toggle="datetimepicker">\n                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>\n                    </div>\n                </div>`},init:function(){let e=this,t=e.dom,n=e.field;e.name=e.name||t.attr("data-field")||n.name,e.max=t.attr("max")||e.max,e.min=t.attr("min")||e.min,t.html(e.getTpl()).find(".date-edit").datetimepicker({format:e.format,locale:moment.locale("zh-cn"),minDate:new Date(e.min),maxDate:new Date(e.max),todayBtn:e.todayBtn,sideBySide:e.sideBySide})},onValueChange:function(e){let t=this;t.dom.find(".date-edit").on("change.datetimepicker",(function(n){e(n,t)}))},setReadonly:function(e){e?this.dom.find("input").attr("readonly",!0):this.dom.find("input").removeAttr("readonly")},getValue:function(){let e=this,t=e.dom.find("input").val(),n=e.dom.find(".date-edit").datetimepicker("viewDate").format(e.format);return t?n:""},setValue:function(e){void 0===e||""===e?this.dom.find(".date-edit").datetimepicker("clear"):this.dom.find(".date-edit").datetimepicker("date",e)}}),jdoo.searchEditor("date",{extends:"editors.date",getCriteria:function(){var e=this.getValue();return e?[[this.name,"=",e]]:[]},getText:function(){return this.getValue()}})},834:()=>{jdoo.searchEditor("date_range",{format:"YYYY-MM-DD",startDate:"2022-01-01",endDate:"2022-02-01",getTpl:function(){return`<div class="input-group dateRanges" id="${this.name+"-"+jdoo.nextId()}">\n                    <div class="input-group-prepend">\n                        <span class="input-group-text">\n                            <span class="far fa-calendar-alt"></span>\n                        </span>\n                    </div>\n                    <input type="text" class="form-control float-right"/>\n                </div>`},init:function(){let e=this,t=e.dom,n=e.field;e.name=e.name||t.attr("data-field")||n.name,e.startDate=t.attr("startDate")||e.startDate,e.endDate=t.attr("endDate")||e.endDate,t.html(e.getTpl()).find("input").daterangepicker({parentEl:".dateRanges",startDate:e.startDate,endDate:e.endDate,locale:{format:e.format}}).on("apply.daterangepicker",(function(t,n){e.startDate=n.startDate.format(e.format),e.endDate=n.endDate.format(e.format)}))},getValue:function(){let e=this;return e.dom.find("input").val()?[e.startDate,e.endDate]:""},getCriteria:function(){let e=this;return this.dom.find("input").val()?["&",[e.name,">=",e.startDate],[e.name,"<=",e.endDate]]:[]},getText:function(){let e=this;return e.dom.find("input").val()?[e.startDate+"至".t()+e.endDate]:""},setValue:function(e){let t=this;if(e&&void 0!==e&&""!==e){let n=e.split(",");t.dom.find("input").val(n[0]+"-"+n[1]),t.startDate=n[0],t.endDate=n[1]}else t.dom.find("input").val("")}})},285:()=>{jdoo.editor("datetime",{extends:"editors.date",statics:{defaults:{format:"YYYY-MM-DD HH:mm:ss"}}}),jdoo.searchEditor("datetime",{extends:"editors.datetime",getCriteria:function(){var e=this.getValue();return e?[[this.name,"=",e]]:[]},getText:function(){return this.getValue()}})},416:()=>{jdoo.searchEditor("datetime_range",{extends:"searchEditors.date_range",format:"YYYY-MM-DD HH:mm:ss",startDate:"2022-01-01 00:00:00",endDate:"2022-02-01 00:00:00",init:function(){let e=this,t=e.dom,n=e.field;e.name=e.name||t.attr("data-field")||n.name,e.startDate=t.attr("startDate")||e.startDate,e.endDate=t.attr("endDate")||e.endDate,t.html(e.getTpl()).find("input").daterangepicker({parentEl:".dateRanges",startDate:e.startDate,endDate:e.endDate,locale:{format:e.format},timePicker:!0,timePicker24Hour:!0}).on("apply.daterangepicker",(function(t,n){e.startDate=n.startDate.format(e.format),e.endDate=n.endDate.format(e.format)}))}})},329:()=>{jdoo.editors={},jdoo.searchEditors={},jdoo.component("editors.Editor",{getRawValue:function(){return this.getValue()},getValue:jdoo.emtpyFn,setValue:jdoo.emtpyFn,onValueChange:jdoo.emtpyFn,setReadonly:jdoo.emtpyFn,valid:jdoo.emtpyFn}),jdoo.editor=function(e,t){"function"==typeof t&&(t=t()),t.extends=t.extends||"editors.Editor",jdoo.editors[e]=jdoo.component("editors."+e,t)},jdoo.searchEditor=function(e,t){"function"==typeof t&&(t=t()),t.extends=t.extends||"editors.Editor",jdoo.searchEditors[e]=jdoo.component("searchEditors."+e,t)}},629:()=>{jdoo.editor("float",{extends:"editors.integer",getTpl:function(e){return`<input type="number" id="${this.name+"-"+jdoo.nextId()}"\n                    ${this.min?' min="'+this.min+'"':""}\n                    ${this.max?' max="'+this.max+'"':""}\n                    ${this.step?' step="'+this.step+'"':""}\n                    ${this.decimals?' data-decimals="'+this.decimals+'"':""}/>`},init:function(){var e=this,t=e.dom,n=e.field;e.name=e.name||t.attr("data-field")||n.name,e.min=e.min||t.attr("min"),e.max=e.max||t.attr("max"),e.step=e.step||t.attr("step"),e.decimals=e.decimals||t.attr("decimals")||"2",t.html(e.getTpl()),e.initSpinner(t.find("input[type=number]"))}}),jdoo.searchEditor("float",{extends:"editors.float",getCriteria:function(){var e=this.getValue();return e?[[this.name,"=",e]]:[]},getText:function(){return this.getValue()}})},977:()=>{jdoo.editor("html",{extends:"editors.text"})},648:()=>{jdoo.editor("image",{size:10,width:150,type:["image/png","image/jpeg","image/gif"],compress:!1,quality:1,placeholder:"/res/org/jdoo/base/statics/img/placeholder.png",getTpl:function(){let e=this;return`<div class="image-edit" id="${e.name+"-"+jdoo.nextId()}">\n                    <ul class="content-img">\n                        <li style="width:${e.width}px"><img src="${e.src}" alt="">\n                            <div class="hide tbar">\n                                <a class="delete-btn"><span class="fa fa-trash"></span></a>\n                                <a class="edit-btn"><span class="fa fa-pencil-alt"></span></a>\n                            </div>\n                        </li>\n                    </ul>\n                    <input type="file" style="display:none" name="file" accept="image/*" />\n                </div>`},init:function(){let me=this,dom=me.dom,field=me.field;me.name=me.name||dom.attr("data-field")||field.name,me.size=eval(dom.attr("size")||me.size),me.type=eval(dom.attr("type")||me.type),me.compress=eval(dom.attr("compress")||me.compress),me.quality=eval(dom.attr("quality")||me.quality),me.width=eval(dom.attr("width")||me.width),me.length=eval(dom.attr("length")||me.field.length),me.src=me.placeholder,dom.html(me.getTpl()).on("mouseover",".content-img",(function(){dom.hasClass("readonly")||dom.find(".tbar").removeClass("hide")})).on("mouseleave",".content-img",(function(){dom.find(".tbar").addClass("hide")})).on("click",".delete-btn",(function(){me.setValue(null),dom.triggerHandler("valueChange",[me])})).on("click",".edit-btn",(function(){dom.find("input[type=file]").click()})).on("change","input",(function(){let e=this.files[0];if(e){if(e.size>512e3*me.size){let e="上传图片不能超过".t()+me.size+"M";return void me.elem.next(".invalid-feedback").html(e).show()}if(-1==me.type.indexOf(e.type)){let e="图片上传格式不正确,必须是png,jpeg,gif".t();return void me.elem.next(".invalid-feedback").html(e).show()}let t=new FileReader;t.readAsDataURL(e);let n=new Image;t.onload=function(e){let t=e.target.result;me.compress&&(n.src=e.target.result,n.onload=function(){let e=document.createElement("canvas"),i=e.getContext("2d"),a=n.width,o=n.height;Math.max(a,o)>me.width?a>o?(e.width=me.width,e.height=me.width*o/a):(e.height=me.width,e.width=me.width*a/o):(e.width=a,e.height=o),i.clearRect(0,0,e.width,e.height),i.drawImage(this,0,0,e.width,e.height),t=e.toDataURL("image/jpeg",quality)}),me.setValue(t),dom.find("input").val(""),dom.triggerHandler("valueChange",[me])}}}))},onValueChange:function(e){this.dom.on("valueChange",e)},setReadonly:function(e){let t=this;e?t.dom.addClass("readonly"):t.dom.removeClass("readonly"),t.updateImg()},getValue:function(){let e=this.data,t=(e||"").indexOf("base64,");return e&&t>-1?e.substring(t+7):e},setValue:function(e){e&&!e.startsWith("data:image")&&(e="data:image/png;base64,"+e),this.data=e,this.updateImg()},updateImg:function(){let e=this,t=e.dom,n=e.data||e.placeholder;t.find("img").attr("src",n),e.data?t.find(".delete-btn").show():t.find(".delete-btn").hide()}})},583:()=>{jdoo.editor("integer",{getTpl:function(){return`<input type="number" id="${this.name+"-"+jdoo.nextId()}"\n                    ${this.min?' min="'+this.min+'"':""}\n                    ${this.max?' max="'+this.max+'"':""}\n                    ${this.step?' step="'+this.step+'"':""}/>`},buttonsClass:"input-group-text",decrementButton:'<i class="fa fa-minus"></i>',incrementButton:'<i class="fa fa-plus"></i>',init:function(){let e=this,t=e.dom,n=e.field;e.name=e.name||t.attr("data-field")||n.name,e.min=e.min||t.attr("min"),e.max=e.max||t.attr("max"),e.step=e.step||t.attr("step"),t.html(e.getTpl()),e.initSpinner(t.find("input[type=number]"))},initSpinner:function(e){let t=this;e.inputSpinner({buttonsClass:t.buttonsClass,decrementButton:t.decrementButton,incrementButton:t.incrementButton})},onValueChange:function(e){let t=this;t.dom.find("input").on("change",(function(n){e(n,t)}))},setReadonly:function(e){let t=this;e?t.initSpinner(t.dom.children("input").attr("readonly",!0)):t.initSpinner(t.dom.children("input").removeAttr("readonly"))},getValue:function(){return this.dom.children("input").val()},setValue:function(e){null===e&&(e=void 0),this.dom.children("input").val(e)}}),jdoo.searchEditor("integer",{extends:"editors.integer",getCriteria:function(){let e=this.getValue();return e?[[this.name,"=",e]]:[]},getText:function(){return this.getValue()}})},636:()=>{jdoo.editor("many2many",{buttonsTpl:{add:`<button name="add" type="button" class="btn btn-success mr-1" click="target.addValue()">${"添加".t()}</button>`,remove:`<button name="remove" type="button" t-enable="ids" class="btn btn-danger" click="target.removeValue()">${"删除".t()}</button>`},lookupTpl:`<div class="modal fade" id="modal-m2m">\n                    <div class="modal-dialog modal-xl">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <h4 class="modal-title">${"选择".t()}<span class="comodel-name"></span></h4>\n                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>\n                            <div class="modal-body">\n                                <div class="m2m-pager"></div>\n                                <div class="grid-sm m2m-cogrid"></div>\n                            </div>\n                            <div class="modal-footer justify-content-between">\n                                <button type="button" class="btn btn-default" data-dismiss="modal">${"关闭".t()}</button>\n                                <button type="button" role="btn-save" class="btn btn-primary">${"确定".t()}</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>`,getTpl:function(){return`<div role="tbar"></div><div class="grid-sm m2m-grid" id="m2m_${this.name+"-"+jdoo.nextId()}">${"加载中".t()}</div>`},init:function(){let e=this,t=e.dom,n=e.field;e.name=e.name||t.attr("data-field")||n.name,e.delete=[],e.create=[],t.html(e.getTpl())},updateGrid:function(){let e=this;if(e.fields){let t=e.dom.children(".m2m-grid");t.html(""),e.grid=t.JGrid({model:e.field.comodel,module:e.module,arch:e.arch,fields:e.fields,selected:function(t,n,i){let a=[];$.each(i,(function(t,n){a.push(e.data[n])})),e.toolbar&&e.toolbar.update(a)},ajax:function(t,n,i,a){e.data?n({data:e.data}):jdoo.rpc({model:e.model,module:e.module,method:"searchRelated",args:{relatedField:e.field.name,options:{criteria:[["id","in",e.values||[]]],nextTest:!0,offset:0,limit:e.field.limit,fields:t.getFields(),order:t.getSort()}},context:{usePresent:!0},onsuccess:function(t){e.data=t.data.values,n({data:t.data.values})}})}}),e.initToolbar()}else jdoo.rpc({model:"ir.ui.view",method:"loadFields",args:{model:e.field.comodel},onsuccess:function(t){e.fields=t.data.fields,e.updateGrid()}})},initToolbar:function(){let e=this;e.grid&&!e.dom.hasClass("readonly")&&(e.toolbar=e.dom.find("[role=tbar]").JToolbar({arch:e.grid.tbarArch||"<toolbar/>",auths:"@all",buttons:"default",buttonsTpl:e.buttonsTpl,defaultButtons:"add|remove",target:e}))},addValue:function(){let e=this;$("#modal-m2m").remove(),$(document.body).append(e.lookupTpl);let t=$("#modal-m2m");t.find("[role=btn-save]").on("click",(function(){let n=i.getSelected();for(let t=0;t<n.length;t++){let a=n[t],o=i.data[a];e.delete.indexOf(a)>-1?e.delete.remove(a):e.create.push(a),e.data.push(o)}e.grid.table.draw(),t.modal("hide"),e.dom.triggerHandler("valueChange",[e])})),t.modal({backdrop:!1}),t.find(".m2m-pager").empty(),t.find(".m2m-cogrid").empty();let n=t.find(".m2m-pager").JPager({pageChange:function(e,t){i.load()},counting:function(t,n){jdoo.rpc({model:e.model,module:e.module,method:"count",args:{criteria:[]},onsuccess:function(e){n.update({total:e.data})}})}}),i=t.find(".m2m-cogrid").JGrid({model:e.field.comodel,module:e.module,arch:e.arch,fields:e.fields,selected:function(e,t,n){},rowDblClick:function(n,i,a){let o=i.data[a];e.delete.indexOf(a)>-1?e.delete.remove(a):e.create.push(a),e.data.push(o),e.grid.table.draw(),t.modal("hide"),e.dom.triggerHandler("valueChange",[e])},ajax:function(t,a,o,l){jdoo.rpc({model:e.model,module:e.module,method:"searchRelated",args:{relatedField:e.field.name,options:{criteria:[["id","not in",e.values]],nextTest:!0,offset:n.getOffest(),limit:n.getLimit(),fields:t.getFields(),order:t.getSort(),activeTest:!0}},context:{active_test:!0,usePresent:!0},onsuccess:function(e){if(e.data.values.length>0){let t=n.getOffest()+e.data.values.length;!1===e.data.hasNext?n.update({to:t,next:!1,total:t}):n.update({to:t,next:!0})}else n.hide();a({data:e.data.values}),i.data={},$.each(e.data.values,(function(e,t){i.data[t.id]=t}))}})}})},removeValue:function(){let e=this,t=e.grid.table.row().id();e.create.indexOf(t)>-1?e.create.remove(t):e.delete.push(t);for(let n=0;n<e.data.length;n++)if(e.data[n].id===t){e.data.splice(n,1);break}e.grid.table.draw(),e.dom.triggerHandler("valueChange",[e])},onValueChange:function(e){this.dom.on("valueChange",e)},setReadonly:function(e){let t=this;e?(t.dom.find("[role=tbar]").empty(),t.dom.addClass("readonly")):(t.dom.removeClass("readonly"),t.initToolbar())},getValue:function(){let e=this,t=[];for(let n=0;n<e.create.length;n++)t.push([4,e.create[n],0]);for(let n=0;n<e.delete.length;n++)t.push([3,e.delete[n],0]);return t},setValue:function(e){let t=this;t.values=e||[],delete t.data,t.delete=[],t.create=[],t.updateGrid()}})},141:()=>{jdoo.editor("many2many_tags",{limit:10,getTpl:function(){return`<div class="form-control m2m-tag" id="${this.name+"-"+jdoo.nextId()}">\n                    <div class="m2m-tag-container">\n                        <ul class="m2m-tag-selection-body">\n                            <li class="m2m-tag-input">\n                                <input type="text" class="lookup m2m-tag-field"/>\n                            </li>\n                        </ul>\n                    </div>\n                    <div class="container-fluid dropdown-lookup search-dropdown">\n                        <div class="lookup-body"></div>\n                        <div class="card-footer">\n                            <div class="btn-group float-right">\n                                <button type="button" data-btn="prev" class="btn btn-sm btn-default">\n                                    <i class="fa fa-angle-left"></i>\n                                </button>\n                                <button type="button" data-btn="next" class="btn btn-sm btn-default">\n                                    <i class="fa fa-angle-right"></i>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>`},init:function(){let e,t=this,n=t.dom,i=t.field;t.name=t.name||n.attr("data-field")||i.name,t.offset=0,t.delete=[],t.create=[],t.keyword="",n.html(t.getTpl()).on("click","[data-btn=next]",(function(e){t.offset+=t.limit,t.lookup()})).on("click","[data-btn=prev]",(function(e){t.offset-=t.limit,t.offset<0&&(t.offset=0),t.lookup()})).on("click",".m2m-tag-container",(function(e){t.dom.attr("readonly")||(t.showDropdown(),t.lookup(),e.preventDefault(),e.stopPropagation())})).on("click",".dropdown-lookup",(function(e){t.dropclick=!0})).on("click",".m2m-tag-choice-remove",(function(e){$(this).closest("li").remove();let i=$(this).closest("li").data().value;t.create.indexOf(i)>-1?t.create.remove(i):t.delete.push(i),n.triggerHandler("valuechange",[t]),e.preventDefault(),e.stopPropagation()})),$(document).on("click",(function(){t.dropclick?t.dropclick=!1:t.hideDropdown()})),n.find("input").keyup((function(){let n=$(this);t.open||t.showDropdown(),clearTimeout(e),e=setTimeout((function(){t.offset=0,t.keyword=n.val(),t.lookup()}),500)}))},onValueChange:function(e){this.dom.on("valuechange",e)},lookup:function(){let e=this,t=e.dom.find(".lookup-body");t.html('<div class="m-2">'+"加载中".t()+"</div>");let n=[["present","like",e.keyword]];jdoo.rpc({model:e.model,module:e.module,method:"searchRelated",args:{relatedField:e.field.name,options:{limit:e.limit,offset:e.offset,criteria:n,nextTest:!0,activeTest:!0}},onsuccess:function(n){if(n.data.values[0]){let i='<div class="select2-container select2-container--default select2-container--open row"><ul class="select2-results__options col-12">';$.each(n.data.values,(function(){let t="";-1!=e.getSelected().indexOf(this.id)&&(t=' m2m-tag-selected" "aria-selected"="true'),i+=`<li class="select2-results__option${t}" data-value="${this.id}">${this.present}</li>`})),i+="</ul></div>",t.html(i),t.find(".select2-results__option").hover((function(){t.find(".select2-results__option").removeClass("select2-results__option--highlighted").removeAttr("aria-selected"),$(this).addClass("select2-results__option--highlighted").attr("aria-selected","true")})).on("click",(function(){let t=$(this),n=t.html(),i=t.data().value,a=[{present:n,id:i}];-1==e.getSelected().indexOf(i)&&e.addValue(a,"create"),e.hideDropdown()}))}else t.html(`<div class="m-2">${"没有数据".t()}</div>`);let i=e.dom.find("[data-btn=next]");n.data.hasNext?i.attr("disabled",!1):i.attr("disabled",!0)}})},renderData:function(){let e=this;jdoo.rpc({model:e.model,module:e.module,method:"searchRelated",args:{relatedField:e.field.name,options:{criteria:[["id","in",e.values||[]]],offset:0,limit:e.limit}},onsuccess:function(t){let n=t.data.values;e.addValue(n,"unchanged")}})},addValue:function(e,t){let n=this,i="",a=n.dom.attr("readonly");$.each(e,(function(){"create"==t&&n.create.push(this.id),i+='<li class="m2m-tag-choice"  data-value="'+this.id+'">  <span class="m2m-tag-choice-remove" '+(a?'style="display:none"':"")+' role="presentation">×</span>'+this.present+" </li>"})),n.dom.find(".lookup").closest("li").before(i),"unchanged"!==t&&n.dom.triggerHandler("valuechange",[n])},showDropdown:function(){let e=this;e.dom.find(".dropdown-lookup").show(),e.dom.find(".m2m-tag-field").css("min-width","80px").focus(),e.open=!0},hideDropdown:function(){let e=this;e.dom.find(".dropdown-lookup").hide(),e.dom.find(".m2m-tag-field").val("").css("min-width","0"),e.offset=0,e.keyword="",e.open=!1},setReadonly:function(e){let t=this;e?(t.dom.find(".m2m-tag-choice-remove,.m2m-tag-field").hide(),t.dom.attr("readonly",!0)):(t.dom.find(".m2m-tag-choice-remove,.m2m-tag-field").show(),t.dom.removeAttr("readonly"))},getSelected:function(){let e=[];return this.dom.find("li.m2m-tag-choice").map((function(t){e.push($(this).attr("data-value"))})),e},getValue:function(){let e=this,t=[];for(let n=0;n<e.create.length;n++)t.push([4,e.create[n],0]);for(let n=0;n<e.delete.length;n++)t.push([3,e.delete[n],0]);return t},setValue:function(e){let t=this;t.values=e||[],t.delete=[],t.create=[],t.dom.find("li.m2m-tag-choice").map((function(e){$(this).closest("li").remove()})),t.renderData()}})},187:()=>{jdoo.editor("many2one",{limit:10,link:!0,getTpl:function(){return`<div class="input-group" id="${this.name+"-"+jdoo.nextId()}">\n                    <input type="text" class="form-control lookup"/>\n                    <div class="container-fluid dropdown-lookup search-dropdown">\n                        <div class="lookup-body"></div>\n                        <div class="card-footer">\n                            <button type="button" data-btn="clear" class="btn btn-sm btn-default">${"清空".t()}</button>\n                            <div class="btn-group float-right">\n                                <button type="button" data-btn="prev" class="btn btn-sm btn-default">\n                                    <i class="fa fa-angle-left"></i>\n                                </button>\n                                <button type="button" data-btn="next" class="btn btn-sm btn-default">\n                                    <i class="fa fa-angle-right"></i>\n                                </button>\n                            </div>\n                        </div>\n                    </div>`+(this.link?'<div class="input-group-append">\n                    <button type="button" data-btn="link" class="btn btn-default">\n                        <i class="fa fa-external-link-alt"></i>\n                    </button>\n                </div></div>':"</div>")},init:function(){let me=this,dom=me.dom,field=me.field,timer;me.name=me.name||dom.attr("data-field")||field.name,me.link=eval(dom.attr("link")||me.link),me.offset=0,me.keyword="",dom.html(me.getTpl()).on("click",".lookup-create",(function(){me.showLinkModel({present:dom.find("input").val()})})).on("click","[data-btn=link]",(function(e){let t=dom.find("input").attr("data-value");me.showLinkModel({id:t})})).on("click",".dropdown-lookup",(function(e){me.dropclick=!0})).on("click",".lookup",(function(e){$(this).attr("readonly")||(me.showDropdown(),me.lookup(),e.preventDefault(),e.stopPropagation())})).on("click","[data-btn=clear]",(function(e){me.offset=0,me.keyword="",me.setValue(),dom.find("input").triggerHandler("change")})).on("click","[data-btn=next]",(function(e){me.offset+=me.limit,me.lookup()})).on("click","[data-btn=prev]",(function(e){me.offset-=me.limit,me.offset<0&&(me.offset=0),me.lookup()})),$(document).on("click",(function(){me.dropclick?me.dropclick=!1:me.hideDropdown()})),dom.find("input").keyup((function(){let e=$(this);e.attr("readonly")||(me.open||me.showDropdown(),clearTimeout(timer),timer=setTimeout((function(){me.offset=0,me.keyword=e.val(),me.lookup()}),500))}))},onValueChange:function(e){let t=this;t.dom.find("input").on("change",(function(n){e(n,t)}))},setReadonly:function(e){e?this.dom.find("input").attr("readonly",!0):this.dom.find("input").removeAttr("readonly")},getValue:function(){let e=this.dom.find("input"),t=e.attr("data-value");return t?[t,e.attr("data-text")]:null},getRawValue:function(){return this.dom.find("input").attr("data-value")||null},setValue:function(e){let t=this.dom.find("[data-btn=link]"),n=this.dom.find("input");e&&e[0]?(n.val(e[1]).attr("data-value",e[0]).attr("data-text",e[1]),t.attr("disabled",!1)):(n.val("").attr("data-value","").attr("data-text",""),t.attr("disabled",!0))},showLinkModel:function(e){let t=this,n=t.field.comodel,i=t.dom.attr("label");i||(i=t.field.label||t.field.name),jdoo.showDialog({submitText:"保存".t(),title:"打开".t()+" "+i.t(),init:function(){let i=this;jdoo.rpc({model:"ir.ui.view",method:"loadView",args:{model:n,type:"form"},onsuccess:function(a){let o=a.data;if("@all"!==o.auths&&-1==o.indexOf("update")&&-1==o.indexOf("create")&&i.dom.find("button[role=btn-save]").hide(),i.form=i.body.JForm({model:n,module:t.module,fields:o.fields,arch:o.views.form.arch,ajax:function(e,n){jdoo.rpc({model:t.model,module:t.module,method:"searchRelated",args:{relatedField:t.field.name,options:{limit:1,offset:0,criteria:[["id","=",i.form.dataId]],fields:i.form.getFields()}},context:{usePresent:!0},onsuccess:function(e){n({data:e.data.values[0]})}})}}),e.id)i.form.dataId=e.id,i.form.load();else{let t={active:!0};t[o.present[0]]=e.present,i.form.create(t)}}})},submit:function(){let e=this;if(!e.form.valid())return;e.busy(!0);let n,i,a=e.form.dataId,o=e.form.getData();a?(n="update",i={ids:[a],values:o}):(n="create",i=o),jdoo.rpc({model:t.field.comodel,module:t.module,method:n,args:i,dialog:e,onsuccess:function(t){a||(e.form.dataId=t.data),e.form.load()}})}})},lookup:function(){let e=this,t=e.dom.find("input"),n=e.dom.attr("search")||null,i=e.dom.find(".lookup-body");i.html('<div class="m-2">'+"加载中".t()+"</div>");let a=[["present","like",e.keyword]];if(n){n=decodeURI(n);let t=e.owner.getRawData();t.__filter=new Function("return "+n),n=t.__filter(),$.each(n,(function(){a.push(this)}))}jdoo.rpc({model:e.model,module:e.module,method:"searchRelated",args:{relatedField:e.field.name,options:{limit:e.limit,offset:e.offset,criteria:a,nextTest:!0,activeTest:!0}},onsuccess:function(n){if(n.data.values[0]){let a='<div class="select2-container select2-container--default select2-container--open row"><ul class="select2-results__options col-12">';$.each(n.data.values,(function(){let e=this.id===t.attr("data-value")?' select2-results__option--highlighted" "aria-selected"="true':"";a+='<li class="select2-results__option'+e+'" data-value="'+this.id+'">'+this.present+"</li>"})),a+="</ul></div>",i.html(a),i.find(".select2-results__option").hover((function(){i.find(".select2-results__option").removeClass("select2-results__option--highlighted").removeAttr("aria-selected"),$(this).addClass("select2-results__option--highlighted").attr("aria-selected","true")}),(function(){})).on("click",(function(){let t=$(this),n=t.html();e.offset=0,e.keyword="",e.setValue([t.attr("data-value"),n]),e.dom.find("input").triggerHandler("change"),e.hideDropdown()}))}else{let n=function(){let n='<div class="m-2 lookup-nodata">'+"没有数据".t()+"</div>";e.canCreate&&(n+='<a class="m-2 lookup-create"><i class="mr-2">'+"创建".t()+'</i>"'+t.val()+'"</a>'),i.html(n)};null==e.canCreate?jdoo.rpc({model:"rbac.security",method:"canCreate",args:{model:e.field.comodel},onsuccess:function(t){e.canCreate=t.data,n()}}):n()}let a=e.dom.find("[data-btn=next]");n.data.hasNext?a.attr("disabled",!1):a.attr("disabled",!0)}})},showDropdown:function(){this.dom.find(".dropdown-lookup").show().addClass("show"),this.open=!0},hideDropdown:function(){let e=this;e.dom.find(".dropdown-lookup").hide().removeClass("show");let t=e.dom.find("input"),n=t.val();n?n!=t.attr("data-text")&&t.val(t.attr("data-text")):(e.setValue(),e.dom.find("input").triggerHandler("change")),e.offset=0,e.keyword="",e.open=!1}}),jdoo.searchEditor("many2one",{extends:"editors.many2one",getCriteria:function(){var e=this.getRawValue();return e?[[this.name,"=",e]]:[]},getText:function(){return this.dom.find("input").val()}})},655:()=>{juicer.options._method.__escapehtml.detection=function(e){return null==e?"":e},moment.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(e,t){return 12===e&&(e=0),"凌晨"===t||"早上"===t||"上午"===t?e:"下午"===t||"晚上"===t?e+12:e>=11?e:e+12},meridiem:function(e,t,n){var i=100*e+t;return i<600?"凌晨":i<900?"早上":i<1130?"上午":i<1230?"中午":i<1800?"下午":"晚上"},calendar:{sameDay:"[今天]LT",nextDay:"[明天]LT",nextWeek:function(e){return e.week()!==this.week()?"[下]dddLT":"[本]dddLT"},lastDay:"[昨天]LT",lastWeek:function(e){return this.week()!==e.week()?"[上]dddLT":"[本]dddLT"},sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(日|月|周)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"周";default:return e}},relativeTime:{future:"%s后",past:"%s前",s:"几秒",ss:"%d 秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",w:"1 周",ww:"%d 周",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},week:{dow:1,doy:4}})},286:()=>{jdoo.editor("one2many",{limit:1e3,buttonsTpl:{add:`<button name="add" type="button" class="btn btn-success mr-1" click="target.addValue()">${"添加".t()}</button>`,edit:`<button name="edit" type="button" t-enable="id" class="btn btn-info mr-1" click="target.editValue()">${"编辑".t()}</button>`,remove:`<button name="remove" type="button" t-enable="ids" class="btn btn-danger" click="target.removeValue()">${"删除".t()}</button>`},getTpl:function(){return`<div role="tbar"></div><div class="grid-sm o2m-grid" id="o2m_${this.name+"-"+jdoo.nextId()}">${"加载中".t()}</div>`},init:function(){let e=this,t=e.dom,n=e.field;e.name=e.name||t.attr("data-field")||n.name,e.delete=[],e.create=[],e.update=[],t.html(e.getTpl()),e.initToolbar()},initToolbar:function(){let e=this;e.grid&&!e.dom.hasClass("readonly")&&(e.toolbar=e.dom.find("[role=tbar]").JToolbar({arch:e.grid.tbarArch||"<toolbar/>",auths:"@all",buttons:"default",buttonsTpl:e.buttonsTpl,defaultButtons:"add|edit|remove",target:e}))},updateGrid:function(){let e=this;if(e._fields){let t=e.dom.children(".o2m-grid");t.html(""),e.grid=t.JGrid({model:e.field.comodel,module:e.module,arch:e.arch,fields:e._fields,selected:function(t,n,i){let a=[];$.each(i,(function(t,n){$.each(e.data,(function(){this.id===n&&a.push(this)}))})),e.toolbar&&e.toolbar.update(a)},rowDblClick:function(t,n,i){e.dom.hasClass("readonly")||e.editValue()},saveEdit(t,n,i,a){e.saveEdit(n,i,a)},loadEdit(t,n,i){if(n&&n.startsWith("new"))for(let t=0;t<e.data.length;t++){let a=e.data[t];if(a.id===n){i({data:a});break}}else jdoo.rpc({model:t.model,module:t.module,method:"read",args:{ids:[n],fields:t.editForm.getFields()},context:{usePresent:!0},onsuccess:function(e){i({data:e.data[0]})}})},ajax:function(t,n,i,a){e.data?n({data:e.data}):jdoo.rpc({model:e.model,module:e.module,method:"searchRelated",args:{relatedField:e.field.name,options:{criteria:[["id","in",e.values||[]]],offset:0,limit:e.limit,fields:t.getFields(),order:t.getSort()}},context:{usePresent:!0},onsuccess:function(t){e.data=t.data.values,n({data:t.data.values})}})}}),e.grid.onEditValueChange((function(){e.dom.triggerHandler("valueChange",[e])})),e.initToolbar()}else jdoo.rpc({model:"ir.ui.view",method:"loadFields",args:{model:e.field.comodel},onsuccess:function(t){e._fields=t.data.fields,e.updateGrid()}})},removeDataById(e,t){for(let n=0;n<e.length;n++)if(e[n].id===t){e.splice(n,1);break}},saveEdit:function(e,t,n){let i=this;if(e){t.id=e;for(let n=0;n<i.data.length;n++){let a=i.data[n];a.id===e&&$.extend(a,t)}e.startsWith("new")?(i.removeDataById(i.create,e),i.create.push(t)):(i.removeDataById(i.update,e),i.update.push(t))}else t.id="new-"+jdoo.nextId(),i.create.push(t),i.data.push(t);n(!0)},addValue:function(){this.grid.addData()},editValue:function(){let e=this.grid.getSelected()[0];this.grid.editData(e)},removeValue:function(){let e=this;$.each(e.grid.getSelected(),(function(){let t=this;t.startsWith("new")||e.delete.push(t);for(let n=0;n<e.data.length;n++)if(e.data[n].id===t){e.data.splice(n,1);break}})),e.grid.table.draw(),e.grid.dom.triggerHandler("editValueChange",[e.grid,e.grid.editForm])},onValueChange:function(e){this.dom.on("valueChange",e)},setReadonly:function(e){let t=this;e?(t.dom.find("[role=tbar]").empty(),t.dom.addClass("readonly")):(t.dom.removeClass("readonly"),t.initToolbar())},getValue:function(){let e=this,t=[];for(let n=0;n<e.create.length;n++){let i={};$.extend(i,e.create[n]),delete i.id,t.push([0,0,i])}for(let n=0;n<e.update.length;n++){let i={};$.extend(i,e.update[n]);let a=i.id;delete i.id,t.push([1,a,i])}for(let n=0;n<e.delete.length;n++)t.push([2,e.delete[n],0]);return t},setValue:function(e){let t=this;t.values=e||[],delete t.data,t.delete=[],t.create=[],t.update=[],t.updateGrid()}})},87:()=>{jdoo.editor("password",{extends:"editors.char",statics:{getTpl:function(){return`<input type="password" autocomplete="off" class="form-control" id="${this.name+"-"+jdoo.nextId()}"/>`}}})},26:()=>{jdoo.editor("priority",{fontIcon:"fa fa-star",getTpl:function(){let e=this,t=`<ul class="priority" id="${e.name+"-"+jdoo.nextId()}">`;for(const n in e.options)t+=`<li class="priority-item" title="${e.options[n]}">\n                        <input name="priority" value="${n}" type="radio" style="display:none">\n                        <span><i class="${e.fontIcon}"></i></span></input>\n                    </li>`;return t+="</ul>",t},init:function(){let me=this,dom=me.dom,field=me.field;me.num=0,me.name=me.name||dom.attr("data-field")||field.name,"many2one"===field.type||(me.options=eval(dom.attr("options"))||field.options,dom.html(me.getTpl())),dom.on("mouseover",".priority-item",(function(){me.lightOn($(this).index()+1)})).on("click",".priority-item",(function(){me.num=$(this).index()+1,$(this).find("input").prop("checked",!0).change()})).on("mouseout",(function(){me.lightOn(me.num)}))},onValueChange:function(e){let t=this;t.dom.find("input").on("change",(function(n){e(n,t)}))},setReadonly:function(e){e?this.dom.children("input").attr("disabled",!0):this.dom.children("input").removeAttr("disabled")},lightOn:function(e){this.dom.find(".priority-item").each((function(t){t<e?$(this).addClass("light-on"):$(this).removeClass("light-on")}))},getValue:function(){return this.dom.find("input:radio:checked").val()},setValue:function(e){e?(this.num=this.dom.find("input[value="+e+"]").prop("checked",!0).parent(".priority-item").index()+1,this.lightOn(this.num)):(this.dom.find("input").prop("checked",!1),this.num=0,this.lightOn(this.num))}})},96:()=>{jdoo.editor("radio",{getTpl:function(){let e=jdoo.nextId(),t=this,n=`<div class="form-radio" id="${t.name+"-"+e}">`;for(const i in t.options)n+=`<label class="form-radio-label">\n                        <input class="radio-inline" type="radio" name="radio-${e}" value="${i}"/>\n                        ${t.options[i]}\n                    </label>`;return n+="</div>",n},init:function(){let me=this,dom=me.dom,field=me.field;me.name=me.name||dom.attr("data-field")||field.name,"many2one"===field.type||(me.options=eval(dom.attr("options"))||field.options,dom.html(me.getTpl()))},onValueChange:function(e){let t=this;t.dom.find("input").on("change",(function(n){e(n,t)}))},setReadonly:function(e){e?this.dom.find("input").attr("readonly",!0):this.dom.find("input").removeAttr("readonly")},getValue:function(){return this.dom.find("input:radio:checked").val()},setValue:function(e){e?this.dom.find("input[value="+e+"]").prop("checked",!0):this.dom.find("input").prop("checked",!1)}}),jdoo.searchEditor("radio",{extends:"editors.radio",getCriteria:function(){let e=this.getValue();return e?[[this.name,"=",e]]:[]},getText:function(){return this.options[this.getValue()]}})},255:()=>{jdoo.editor("selection",{getTpl:function(){let e=this,t=`<select class="form-control" id="${e.name+"-"+jdoo.nextId()}">`;e.allowNull&&(t+='<option value=""> </option>');for(const n in e.options)t+=`<option value="${n}">${e.options[n]}</option>`;return t+="</select>",t},init:function(){let me=this,dom=me.dom,field=me.field;me.name=me.name||dom.attr("data-field")||field.name,"many2one"===field.type||(me.options=eval(dom.attr("options"))||field.options,dom.html(me.getTpl()))},onValueChange:function(e){let t=this;t.dom.find("select").on("change",(function(n){e(n,t)}))},setReadonly:function(e){e?this.dom.children("select").attr("disabled",!0):this.dom.children("select").removeAttr("disabled")},getValue:function(){return this.dom.children("select").val()},setValue:function(e){this.dom.children("select").val(e)}}),jdoo.searchEditor("selection",{extends:"editors.selection",getCriteria:function(){let e=this.getValue();return e?[[this.name,"=",e]]:[]},getText:function(){return this.options[this.getValue()]}})},892:()=>{jdoo.editor("text",{getTpl:function(e){return`<textarea id="${this.name+"-"+jdoo.nextId()}" rows="${this.rows}" type="text" class="form-control"/>`},init:function(){let e=this,t=e.dom,n=e.field;e.name=e.name||t.attr("data-field")||n.name,e.rows=e.rows||t.attr("rows")||3,t.html(e.getTpl())},onValueChange:function(e){let t=this;t.dom.find("textarea").on("change",(function(n){e(n,t)}))},setReadonly:function(e){e?this.dom.children("textarea").attr("disabled",!0):this.dom.children("textarea").removeAttr("disabled")},getValue:function(){return this.dom.children("textarea").val()},setValue:function(e){this.dom.children("textarea").val(e)}}),jdoo.searchEditor("text",{extends:"editors.text",getCriteria:function(){let e=this.getValue(),t=e.split(";");return t.length>1?[[this.name,"in",t]]:e?[[this.name,"=",e]]:[]},getText:function(){return this.getValue()}})},364:()=>{$.component("JCard",{ajax:jdoo.emptyFn,init:function(){let me=this,dom=me.dom;if(me._fields=[],me.sel=[],me.arch){let arch=jdoo.utils.parseXML(me.arch),card=arch.children("card");if(card.length>0){me.tbarArch=card.children("toolbar").prop("outerHTML"),me.limit=eval(card.attr("limit")||16),me.pager.limit=me.limit,card.children("field").each((function(){let e=$(this).attr("name"),t=me.fields[e];if(!t)throw new Error("模型"+me.model+"找不到字段"+e);t.deny||me._fields.push(e)}));let tpl=card.children("template").html();me.tpl=juicer(tpl)}}dom.addClass("row mt-3 card-view"),me.load(),me.onSelected(me.selected)},onSelected:function(e){this.dom.on("selected",e)},load:function(){let e=this,t=e.dom;t.html(`<div class="col-12" style="text-align:center;">${"数据加载中".t()}</div>`),e.ajax(e,(function(n){n.data.length>0?(t.empty(),$.each(n.data,(function(n,i){for(let t in this){let n=e.fields[t];if("selection"===n.type){let e=this[t];this[t]=[e,n.options[e]]}}let a=e.tpl.render(this);t.append(`<div class="col-3" style="min-width: 18rem;"><div class="card" data="${this.id}">${a}</div></div>`)}))):t.html(`<div class="col-12" style="text-align:center;">${"没有数据".t()}</div>`),t.find(".card").on("click",(function(){let n=$(this);t.find(".card").removeClass("selected"),n.addClass("selected"),e.sel=[n.attr("data")],t.triggerHandler("selected",[e,e.sel])})),"function"==typeof e.dblClick&&t.find(".card").on("dblclick",(function(){let t=$(this).attr("data");e.dblClick(e,t)})),t.triggerHandler("loaded",[e,n.data]),e.sel=[],t.triggerHandler("selected",[e,e.sel])}))},getSelected:function(){return this.sel},getFields:function(){return this._fields}})},739:()=>{$.component("JCustom",{init:function(){let e=this;if(e.arch){let t=jdoo.utils.parseXML(e.arch).children("custom");t.length>0&&($.each(t[0].attributes,(function(t,n){if("class"===n.name)e.dom.addClass(n.value);else{let t=encodeURI(n.value);e.dom.attr(n.name,t)}})),e.dom.append(t.prop("innerHTML")))}}})},553:()=>{$.component("JForm",{ajax:jdoo.emptyFn,cols:4,getAsideTpl:function(){return`<aside class="left-aside border-right"><div class="m-1">\n                    <div class="input-group input-group-sm">\n                        <div class="input-group-prepend">\n                            <button class="btn btn-default btn-sm tree-expand"><i class="fas fa-chevron-down"></i></button>\n                            <button class="btn btn-default btn-sm tree-collapse"><i class="fas fa-chevron-up"></i></button>\n                        </div>\n                        <input type="text" class="form-control tree-keyword"/>\n                        <div class="input-group-append">\n                            <div data-btn="view" class="btn btn-default tree-lookup">\n                                <i class="fa fa-search"></i>\n                            </div>\n                        </div>\n                    </div>\n                </div><div id="treeview_${jdoo.nextId()}" class="treeview"></div></aside>`},requiredValid:function(editor){let required=editor.dom.attr("required")||editor.field.required;if(eval(required)){let e=editor.getValue();if(""===e||null==e||null==e)return"不能为空".t()}},init:function(){let me=this,dom=me.dom;if(me._fields=[],me.sel=[],me.editors={},me.arch){let arch=jdoo.utils.parseXML(me.arch),form=arch.find("form"),toManyArchs={};if(form.length>0){let tbar=form.children("toolbar");me.tbarArch=tbar.prop("outerHTML"),tbar.remove(),me.isTree=eval(form.attr("tree")),me.isTree&&(me.cols-=1),me.cols<1&&(me.cols=1),me._initFields(form,toManyArchs),me._initTabs(form),me._initGroup(form),form.addClass("grid");let html='<div class="container-fluid form-body"><div class="card-body row"><div class="col-md-12">'+arch.children().prop("outerHTML")+"</div></div></div>";me.isTree&&(html=me.getAsideTpl()+html,dom.css("display","flex")),dom.html(html).find("form").css("grid-template-columns","repeat("+me.cols+", 1fr)").on("click",".field-group .group-expender",(function(){let e=$(this),t=e.parents(".field-group").find(".group-body");e.hasClass("collapsed")?(t.show(),e.removeClass("collapsed"),e.find("[role=button]").removeClass("fa-chevron-down").addClass("fa-chevron-up")):(t.hide(),e.addClass("collapsed"),e.find("[role=button]").removeClass("fa-chevron-up").addClass("fa-chevron-down"))})),me._initTreeView(form),dom.find("[data-field]").each((function(){let e=$(this),t=e.attr("data-field"),n=me.fields[t],i=e.attr("editor")||n.type,a={field:n,model:me.model,module:me.module,owner:me,dom:e},o=jdoo.editors[i];if(!o)throw new Error("找不到编辑器:"+i);"many2many"!==n.type&&"one2many"!==n.type||(a.arch=toManyArchs[t]);let l=new o(a);l.onValueChange&&l.onValueChange((function(e,t){t.dirty=!0,me.dirty=!0,me._updateEditorState(),me.valid(t.field.name)})),me.editors[t]=l})),dom.find("[readonly]").each((function(){let e=$(this),fname=e.attr("form-field"),expr=this.attributes.readonly.value;fname&&me.getEditor(fname).setReadonly(eval(expr))})),dom.find("[t-reset]").each((function(){let e=$(this),t=e.attr("form-field"),n=e.attr("t-reset");t&&$.each(n.split(","),(function(){let e=me.editors[this];e.onValueChange&&e.onValueChange((function(){me.getEditor(t).setValue()}))}))})),dom.find("[data-toggle=tooltip]").tooltip()}}me.onSelected(me.selected),me.data&&me.setData(me.data)},_initTreeView:function(e){let t=this,n=t.dom;if(t.isTree){let i=e.attr("sort_field"),a=null!=i&&""!=i;t.treeview=n.find(".treeview").JTree({model:t.model,module:t.module,fields:t.fields,presentField:e.attr("present_field")||"present",parentField:e.attr("parent_field")||"parent_id",sortField:i,config:function(e){e.edit.drag.prev=a,e.edit.drag.next=a,e.callback.onDrop=function(e,n,i,a,o){if(console.log(arguments),"inner"!==o&&"next"!==o&&"prev"!==o)return;let l=[],d={},r=t.treeview.parentField,s=t.treeview.idField,c=t.treeview.sortField;$.each(i,(function(){l.push(this[s])})),"inner"===o?d[r]=a?a[s]:null:"next"===o?(d[r]=a?a[r]:null,d[c]=a?a[c]+1:0):"prev"===o&&(d[r]=a?a[r]:null,d[c]=a?a[c]-1:0),jdoo.rpc({model:t.model,module:t.module,method:"update",args:{ids:l,values:d},onsuccess:function(e){jdoo.msg.show("保存成功".t()),t.load()}})}},ajax:function(e,i){let a=n.find(".tree-keyword").val();jdoo.rpc({model:t.model,module:t.module,method:"presentSearch",args:{keyword:a,offset:0,limit:0,order:"",fields:e.getFields()},onsuccess:function(e){i(e.data)}})},onselected:function(e,i,a){n.triggerHandler("treeSelected",[t.treeview,a]),a.length>0?view.urlHash.id=a[0].id:delete view.urlHash.id,view.changeView(),t.ajax(t,(function(e){t.setData(e.data)}))}}),t.treeview.load(),n.on("click",".tree-expand",(function(){t.treeview.expandAll()})).on("click",".tree-collapse",(function(){t.treeview.collapseAll()})).on("click",".tree-lookup",(function(){t.treeview.load()}))}t.onTreeSelected(t.treeSelected)},onTreeSelected:function(e){this.dom.on("treeSelected",e)},_initFields:function(form,toManyArchs){let me=this;form.find("field").each((function(){let el=$(this);if(el.parents("field").length>0)return;let name=el.attr("name"),label=el.attr("label"),nolabel=el.attr("nolabel"),help=el.attr("help"),field=me.fields[name],colspan=Math.min(el.attr("colspan")||1,me.cols),rowspan=el.attr("rowspan")||1,css="form-group col-12",attrs="",html='<div form-field="'+name+'" ';if(!field)throw new Error("模型"+me.model+"找不到字段"+name);if(field.deny)el.remove();else{if($.each(this.attributes,(function(e,t){if("class"===t.name)css+=" "+t.value;else{let e=encodeURI(t.value);-1==["name","editor"].indexOf(t.name)&&(html+=t.name+'="'+e+'" '),-1==["t-readonly","t-visible","style","t-reset"].indexOf(t.name)&&(attrs+=t.name+'="'+e+'" ')}})),me._fields.push(name),"many2many"!==field.type&&"one2many"!==field.type||(toManyArchs[name]=el.html()),null==el.attr("readonly")&&field.readonly&&(html+='readonly="1" '),null==help&&(help=field.help),help&&(attrs+=' data-toggle="tooltip" data-original-title="'+help+'"'),html+=' style="grid-column:span '+colspan+";grid-row:span "+rowspan+'"',html+=' class="'+css+'">',!eval(nolabel)){label||(label=field.label||field.name),label=label.t(),html+="<label>"+label+" </label>";let required=eval(el.attr("required"));null==required&&(required=field.required),required&&(html+='<span class="text-danger"> *</span>')}html+='<div data-field="'+name+'"  '+attrs+"> </div>",html+='<span class="invalid-feedback"></span></div>',el.replaceWith(html)}}))},_initGroup:function(form){let me=this;form.find("group").each((function(){let group=$(this),css="field-group",attrs="",cols=eval(group.attr("colspan")||me.cols),styles="grid-column:span "+cols+";";$.each(this.attributes,(function(e,t){if("class"===t.name)css+=" "+t.value;else if("style"===t.name)styles+=" "+t.value;else{let e=encodeURI(t.value);attrs+=t.name+'="'+e+'" '}}));let label=group.attr("label");label&&(label=label.t());let expander=eval(group.attr("collapsable"))?'<div class="group-expender"><span role="button" class="fa fa-chevron-up"></span></div>':"",html=`<div class="${css}" style="${styles}" ${attrs}>\n                            <div class="group-header border-bottom">${label+expander}</div>\n                            <div class="group-body"><div class="group-content grid" style="grid-template-columns:repeat(' + cols + ', 1fr)">${group.prop("innerHTML")}</div></div>\n                        </div>`;group.replaceWith(html)}))},_initTabs:function(e){let t=this;e.find("tabs").each((function(){let e=$(this),n="",i="",a="",o="grid-column:span "+t.cols+";";if($.each(this.attributes,(function(e,t){if("style"===t.name)o+=" "+t.value;else{let e=encodeURI(t.value);a+=t.name+'="'+e+'" '}})),e.children("tab").each((function(e){let t=$(this);if(t.children().length>0){let e=t.attr("label"),a="tab-"+jdoo.nextId(),o=n?"":" active",l=n?"":" show",d="",r="";e&&(e=e.t()),$.each(this.attributes,(function(e,t){if("class"===t.name)r+=" "+t.value;else{let e=encodeURI(t.value);"id"!=t.name&&(d+=t.name+'="'+e+'" ')}})),n+=`<li class="nav-item" ${d}>\n                                <a class="nav-link${o+r}" id="${a}-tab" data-toggle="pill" href="#${a}" role="tab" aria-controls="${a}" aria-selected="true">${e}</a>\n                            </li>`,i+=`<div class="tab-pane fade${l+o}" ${d} id="${a}" role="tabpanel" aria-labelledby="${a}-tab">\n                                    <div class="grid mt-3" style="grid-template-columns:repeat(' + me.cols + ', 1fr)">${t.prop("innerHTML")}</div>\n                                </div>`}})),n){let t=`<div style="${o}" ${a}>\n                                <ul class="nav nav-tabs col-12" role="tablist">${n}</ul>\n                                <div class="tab-content col-12">${i}</div>\n                            </div>`;e.replaceWith(t)}else e.remove()}))},_updateEditorState:function(){let e=this,t=e.dom.find("[t-visible],[t-readonly]");if(t.length>0){let n=e.getData();n.id=n.id||e.dataId,t.each((function(){let t=$(this),i=t.attr("t-visible"),a=t.attr("t-readonly");if(i&&(n.__test_visible=new Function("return "+decodeURI(i)),n.__test_visible()?t.show():t.hide()),a){n.__test_readonly=new Function("return "+decodeURI(a));let i=t.attr("form-field"),o=e.getEditor(i);o&&o.setReadonly(n.__test_readonly())}}))}},onSelected:function(e){this.dom.on("selected",e)},getFields:function(){return this._fields},getSelected:function(){return this.sel},setData:function(e){let t=this;$.each(t.getFields(),(function(n,i){t.getEditor(i).setValue(e[i])})),e.id?t.sel=[e.id]:t.sel=[],t.dataId=e.id||"",t._updateEditorState(),t.clearInvalid(),t.dom.triggerHandler("selected",[t,t.sel])},setInvalid:function(e,t){this.dom.find("[form-field="+e+"] .invalid-feedback").html(t).show(),this.dom.find("[form-field="+e+"] .form-control").addClass("is-invalid")},valid:function(e){let t=this,n=!0,i=function(e){let i=t.getEditor(e),a=[],o=function(e){e&&a.push(e)};"none"!=t.dom.find("[form-field="+e+"]").css("display")&&(o(t.requiredValid(i)),i.valid&&o(i.valid()),a.length>0&&(t.setInvalid(e,a.join(";")),n=!1))};return t.clearInvalid(e),e?i(e):$.each(t.getFields(),(function(e,t){i(t)})),n},clearInvalid:function(e){let t=this;e?(t.dom.find("[form-field="+e+"] .invalid-feedback").empty().hide(),t.dom.find("[form-field="+e+"] .form-control").removeClass("is-invalid")):(t.dom.find(".invalid-feedback").empty().hide(),t.dom.find(".form-control").removeClass("is-invalid"))},getData:function(){let e=this,t={};return $.each(e.getFields(),(function(n,i){t[i]=e.getEditor(i).getValue()})),t},getDirtyData:function(){let e=this,t={};return $.each(e.getFields(),(function(n,i){let a=e.getEditor(i);a.dirty&&(a.getRawValue?t[i]=a.getRawValue():t[i]=a.getValue())})),t},clean:function(){let e=this;e.dirty=!1,$.each(e.getFields(),(function(t,n){e.getEditor(n).dirty=!1}))},getRawData:function(){let e=this,t={};return $.each(e.getFields(),(function(n,i){let a=e.getEditor(i);a.getRawValue?t[i]=a.getRawValue():t[i]=a.getValue()})),t},getEditor:function(e){let t=this.editors[e];if(!t)throw new Error("找不到name=["+e+"]的editor");return t},createChild:function(){let e=this;if(e.treeview){let t=e.treeview.ztree.getSelectedNodes()[0];if(t){delete view.urlHash.id;let n={};$.each(e.getFields(),(function(){let t=e.fields[this];t.defaultValue&&(n[this]=t.defaultValue)})),n[e.treeview.parentField]=[t.id,t[e.treeview.presentField]],e.setData(n)}}},create:function(e){let t=this,n={};$.each(t.getFields(),(function(){let e=t.fields[this];n[this]=e.defaultValue})),$.extend(!0,n,e),t.setData(n)},load:function(){let e=this;e.treeview&&e.treeview.load(),e.ajax(e,(function(t){e.setData(t.data),e.clean()}))}})},337:()=>{$.component("JGrid",{ajax:function(e,t,n,i){t({data:[]})},saveEdit:jdoo.emptyFn,loadEdit:function(e,t,n){jdoo.rpc({model:e.model,module:e.module,method:"read",args:{ids:[t],fields:e.editForm.getFields()},context:{usePresent:!0},onsuccess:function(e){n({data:e.data[0]})}})},getEditFBarTpl:function(){return`<td colspan="500"><div class="grid-edit"></div>\n                    <div class="grid-edit-tbar">\n                        <button name="cancel" class="btn btn-outline-secondary">${"取消".t()}</button>\n                        <button name="confirm" class="btn btn-info float-right" style="min-width:100px">${"确定".t()}</button>\n                    </div>\n                </td>`},init:function(){let me=this,columnDefs=[],columnIndex=0,columnOrder=0;if(me._fields=[],me.arch){let arch=jdoo.utils.parseXML(me.arch),grid=arch.children("grid");if(grid.length>0){me.limit=eval(grid.attr("limit")||10),me.pager.limit=me.limit,me.showRowNum=eval(grid.attr("showRowNum")||"1"),me.multiSelect=eval(grid.attr("multiSelect")||"1"),me.checkSelect=eval(grid.attr("checkSelect")||"0"),me.tbarArch=grid.children("toolbar").prop("outerHTML"),me.editArch=grid.children("edit").prop("innerHTML")||grid.prop("innerHTML");let html='<table class="table table-bordered table-hover '+me.className+'"><thead><tr>';me.checkSelect&&(columnDefs.push({searchable:!1,orderable:!1,data:null,render:function(e,t,n,i){return'<input type="checkbox" class="check-select">'},targets:columnIndex++}),html+='<th style="width:1%"></th>',columnOrder++),me.showRowNum&&(columnDefs.push({searchable:!1,orderable:!1,data:null,render:function(e,t,n,i){return i.row+1},targets:columnIndex++}),html+='<th style="width:1%">#</th>',columnOrder++),grid.children("field").each((function(){let e=$(this),t=e.attr("name"),n=e.attr("label"),i=e.attr("class"),a=e.attr("style"),o=me.fields[t];if(!o)throw new Error("模型"+me.model+"找不到字段"+t);o.deny||(n||(n=o.label||o.name),n=n.t(),me._fields.push(t),html+="<th",i&&(html+=' class="'+i+'"'),a&&(html+=' style="'+a+'"'),html+=">"+n+"</th>",columnDefs.push({render:new(jdoo.columns[e.attr("editor")||o.type]||jdoo.columns.default)({field:o}).render(),data:t,targets:columnIndex++,orderable:o.sortable}))})),html+="</tr></thead></table>",grid.replaceWith(html)}else{let e=arch.children("table");e.find("th").each((function(){let e=$(this).attr("data-data");me._fields.push(e)}))}me.dom.html(arch.children().prop("outerHTML"))}me.table=me.dom.find("table").DataTable({paging:!1,lengthChange:!1,searching:!1,ordering:!0,info:!1,autoWidth:!1,responsive:!0,processing:!0,serverSide:!0,rowId:"id",colReorder:!0,language:{processing:"加载中".t(),zeroRecords:"没有数据".t()},ajax:function(e,t,n){me.sel=[],me.dom.triggerHandler("selected",[me,[]]),me.redraw&&me.data?(t(me.data),me.dom.triggerHandler("loaded",[me,me.data])):me.table&&me.ajax(me,(function(e){me.data=e,t(e),me.dom.triggerHandler("loaded",[me,me.data])}),e,n)},order:[],columnDefs}),me.sel=[],me.table.on("change",".check-select",(function(){let e=$(this),t=me.table.row(e.parents("tr")).id();e.is(":checked")?me.multiSelect?me.sel.push(t):me.sel=[t]:me.sel.remove(t),me.dom.triggerHandler("selected",[me,me.sel])})),me.table.on("click","tbody tr",(function(){let e=$(this);if(me.checkSelect||e.hasClass("edit")||1===e.children(".dataTables_empty").length)return;let t=me.table.row(this).id();me.multiSelect&&window.event.ctrlKey?e.hasClass("selected")?(e.removeClass("selected"),me.sel.remove(t)):(e.addClass("selected"),me.sel.push(t)):(me.table.$("tr.selected").removeClass("selected"),e.addClass("selected"),me.sel=[t]),me.dom.triggerHandler("selected",[me,me.sel])})),me.table.on("dblclick","tbody tr",(function(){let e=$(this);if(me.checkSelect||e.hasClass("edit")||1===e.children(".dataTables_empty").length)return;let t=me.table.row(this).id();me.dom.triggerHandler("rowDblClick",[me,t])})),me.table.ajax.reload(),me.onSelected(me.selected),me.onRowDblClick(me.rowDblClick),me.onEditValueChange(me.editValueChange)},onSelected:function(e){this.dom.on("selected",e)},onRowDblClick:function(e){this.dom.on("rowDblClick",e)},_redraw:function(){let e=this;e.redraw=!0,e.table.draw(),e.redraw=!1,e.dom.find("tr.edit").removeClass("edit")},addData:function(){let e=this;e._redraw(),e.dom.find("table tbody").prepend('<tr id="addNew"></tr>');let t=e.dom.find("#addNew");e._renderEdit(t),e.editForm=t.find(".grid-edit").JForm({arch:'<form log_access="0">'+e.editArch+"</form>",fields:e.fields,model:e.model,module:e.module});let n={};$.each(e.editForm.getFields(),(function(){let t=e.fields[this];n[this]=t.defaultValue})),e.editForm.setData(n)},_renderEdit:function(e,t){let n=this;e.addClass("edit").html(n.getEditFBarTpl()),e.find("[name=cancel]").on("click",(function(){n._redraw()})),e.find("[name=confirm]").on("click",(function(){if(n.editForm.valid()){let e=$(this);e.attr("disabeld",!0),n.saveEdit(n,t,n.editForm.getData(),(function(t){t?(n.load(),n.dom.triggerHandler("editValueChange",[n,n.editForm])):e.attr("disabeld",!1)}))}}))},onEditValueChange:function(e){this.dom.on("editValueChange",e)},editData:function(e){let t=this;if(e=e||t.sel[0]){t._redraw();let n=t.dom.find("#"+e);t._renderEdit(n,e),t.editForm=n.find(".grid-edit").JForm({arch:'<form log_access="0">'+t.editArch+"</form>",fields:t.fields,model:t.model,module:t.module,ajax:function(n,i){t.loadEdit(t,e,i)}}),t.editForm.load()}},getTable:function(){return this.table},getFields:function(){return this._fields},getSelected:function(){return this.sel},getSort:function(){let e=this,t="";return e.table&&$.each(e.table.order(),(function(n,i){let a=e.table.column(i[0]).dataSrc();a&&(""!=t&&(t+=","),t+=a+" "+i[1])})),t},load:function(){this.table.ajax.reload()}})},411:()=>{$.component("JPager",{pageSize:10,getTpl:function(){return'<div class="btn-group">\n                    <div class="pager-from input-group input-group-sm" style="padding: 0;"><span>1</span></div>\n                    <span style="min-width:.8rem;text-align: center;">-</span>\n                    <div class="pager-to input-group input-group-sm" style="padding: 0;"></div>\n                    <span style="min-width:1rem;text-align: center;">/</span>\n                    <div class="pager-total" style="padding: 0;"><span>?</span></div>\n                </div>\n                <div class="btn-group ml-2">\n                    <button type="button" class="btn btn-sm btn-default pager-prev">\n                        <i class="fa fa-angle-left"></i>\n                    </button>\n                    <button type="button" class="btn btn-sm btn-default pager-next">\n                        <i class="fa fa-angle-right"></i>\n                    </button>\n                </div>'},init:function(){let e=this,t=e.dom;e.limit=e.pageSize,e.from=1,e.to=e.limit,t.html(e.getTpl()).on("click","div.pager-from",(function(n){let i=$(this);if(!i.hasClass("edit")){i.html('<input type="text" class="form-control" style="width:3rem;">');let n=i.find("input");n.val(e.from),n.focus(),n.on("blur",(function(){let a=parseInt(n.val());!isNaN(a)&&a>0?(e.from=a,i.html("<span>"+a+"</span>"),e.from>e.to&&(e.to=e.from,i.find("div.pager-to").html("<span>"+e.to+"</span>")),e.setLimit(e.to-e.from+1),t.triggerHandler("pageChange",[e])):i.html("<span>"+e.from+"</span>"),i.removeClass("edit")})),i.addClass("edit")}})).on("click","div.pager-to",(function(n){let i=$(this);if(!i.hasClass("edit")){i.html('<input type="text" class="form-control" style="width:3rem;">');let n=i.find("input");n.val(e.to),n.focus(),n.on("blur",(function(){let a=parseInt(n.val());!isNaN(a)&&a>0?(e.to=a,i.html("<span>"+a+"</span>"),e.to<e.from&&(e.from=e.to,i.find("div.pager-from").html("<span>"+e.from+"</span>")),e.setLimit(e.to-e.from+1),t.triggerHandler("pageChange",[e])):i.html("<span>"+e.to+"</span>"),i.removeClass("edit")})),i.addClass("edit")}})).on("click","div.pager-total",(function(n){t.triggerHandler("counting",[e])})).on("click","button.pager-prev",(function(n){e.from>e.limit?e.from-=e.limit:e.from=1,e.to=e.from+e.limit-1,t.triggerHandler("pageChange",[e])})).on("click","button.pager-next",(function(n){e.from+=e.limit,e.to=e.from+e.limit-1,t.triggerHandler("pageChange",[e])})),e.onPageChange(e.pageChange),e.onCounting(e.counting),e.onLimitChange(e.limitChange)},onLimitChange:function(e){this.dom.on("limitChange",e)},onPageChange:function(e){this.dom.on("pageChange",e)},onCounting:function(e){this.dom.on("counting",e)},setLimit:function(e){let t=this;t.limit=e,t.dom.triggerHandler("limitChange",[t])},getLimit:function(){return this.limit},getOffest:function(){return this.from-1},update:function(e){let t=this,n=t.dom;n.show(),e.from&&(t.from=e.from),e.to&&(t.to=e.to),n.find("div.pager-from").html("<span>"+t.from+"</span>"),n.find("div.pager-to").html("<span>"+t.to+"</span>"),!0===e.next?n.find("button.pager-next").attr("disabled",!1):!1===e.next&&n.find("button.pager-next").attr("disabled",!0),n.find("button.pager-prev").attr("disabled",1===t.from);let i=parseInt(e.total);isNaN(i)||n.find("div.pager-total").html("<span>"+i+"</span>")},reset:function(){let e=this,t=e.dom;e.from=1,e.to=e.limit,t.find("div.pager-from").html("<span>"+e.from+"</span>"),t.find("div.pager-to").html("<span>"+e.to+"</span>"),t.find("div.pager-total").html("<span>?</span>"),t.find("button.pager-next").removeClass("disabled")},hide:function(){this.dom.hide()}})},212:()=>{$.component("JSearch",{getTpl:function(){return`<div class="input-group">\n                    <div class="input-group-prepend">\n                        <button type="button" class="btn btn-default dropdown-toggle" data-btn="dropdown">${"过滤".t()}</button>\n                        <div class="container-fluid dropdown-menu search-dropdown" style="min-width:300px">\n                            <div class="search-form"></div>\n                            <div class="card-footer">\n                                <button data-btn="clear" class="btn btn-outline-secondary" style="margin-right:5px">${"清空".t()}</button>\n                                <button data-btn="reset" class="btn btn-outline-secondary" style="margin-right:5px">${"重置".t()}</button>\n                                <button data-btn="confirm" class="btn btn-info float-right" style="min-width:100px">${"确定".t()}</button>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="jsearch-container">\n                        <span class="jsearch-selection">\n                            <ul class="jsearch-selection-body"></ul>\n                        </span>\n                    </div>\n                    <div class="input-group-append">\n                        <button data-btn="submit" type="submit" class="btn btn-default">\n                            <i class="fa fa-search"></i>\n                        </button>\n                    </div>\n                </div>`},init:function(){let e=this,t=e.dom;e.query={},e.editors={},e._fields=[],t.html(e.getTpl()).on("click",".jsearch-selection",(function(t){e.showDropdown(),t.preventDefault(),t.stopPropagation()})).on("click","[data-btn=clear]",(function(){$.each(e._fields,(function(t,n){e.editors[n].setValue("")})),e._updateCriteria(),el.triggerHandler("submitting",[e])})).on("click","[data-btn=reset]",(function(){e.reset(),t.triggerHandler("submitting",[e])})).on("click","[data-btn=confirm]",(function(){e.confirm()})).on("click","[data-btn=submit]",(function(){t.triggerHandler("submitting",[e])})).on("click","[data-btn=dropdown]",(function(t){e.showDropdown(),t.preventDefault(),t.stopPropagation()})).on("click",".dropdown-menu",(function(t){e.dropclick=!0})),e.dropdown=t.find(".search-dropdown"),e.body=t.find(".jsearch-selection-body"),$(document).on("click",(function(){e.dropclick?e.dropclick=!1:e.hideDropdown()})),e.initEditors(),e.onSubmitting(e.submitting),e.dropdown.on("keyup","input,select",(function(t){13==t.keyCode&&e.confirm()})),$.event.trigger("searchReady",[e])},confirm:function(){let e=this;e._updateCriteria(),e.dropdown.removeClass("show"),e.dom.triggerHandler("submitting",[e]),e.hideDropdown()},onSubmitting:function(e){this.dom.on("submitting",e)},showDropdown:function(){let e=this.dom.find(".dropdown-menu");e.show().addClass("show"),e.find("input:first").focus()},hideDropdown:function(){this.dom.find(".dropdown-menu").hide().removeClass("show")},initEditors:function(){let me=this,form='<div class="row">';if(me.arch){let arch=jdoo.utils.parseXML(me.arch).children("search"),searchPanel=arch.find("searchpanel");searchPanel.length>0&&(me.panel=$("[role=search-panel]").show().JSearchPanel({arch:searchPanel.prop("outerHTML"),model:me.model,module:me.module,fields:me.fields,selected:function(e,t,n){me.dom.triggerHandler("submitting",[me])},ajax:function(e,t){jdoo.rpc({model:me.model,module:me.module,method:"searchRelated",args:{relatedField:e.field.name,options:{criteria:e.getSelect(),fields:e.getFields(),limit:e.limit}},onsuccess:function(e){e.data.values.splice(0,0,{present:"全部".t(),id:"all"}),t(e.data.values)}})}}),me.panel.load()),searchPanel.remove(),me.criteria=eval(arch.attr("criteria"));let fields=arch.children("field"),col=arch.col||(fields.length<=3?1:fields.length<=6?2:3);me.dropdown.addClass("col-md-"+4*col);let forms=[];for(let e=0;e<col;e++)forms[e]='<div class="col-md-'+12/col+' form-horizontal"><div class="card-body">';fields.each((function(e,t){let n=$(t),i=n.attr("name"),a=n.attr("label"),o=n.attr("default"),l=n.attr("op"),d=n.attr("criteria"),r=n.attr("editor"),s=me.fields[i];if(!s)throw new Error("模型"+me.model+"找不到字段"+i);if(!s.deny){a||(a=s.label||s.name),a=a.t(),me._fields.push(i);let t='<div class="form-group"><label>'+a+'</label><div data-label="'+a+'"'+(o?' data-default="'+o+'"':"")+(l?' data-op="'+l+'"':"")+(r?' data-editor="'+r+'"':"")+(d?' data-criteria="'+encodeURI(d)+'"':"")+' data-field="'+i+'"></div></div>';forms[e%col]+=t}}));for(let e=0;e<col;e++)form+=forms[e]+"</div></div>"}form+="</div>",me.dropdown.prepend(form),me.dropdown.find("[data-field]").each((function(){let e=$(this),t=e.attr("data-field"),n=me.fields[t],i=e.attr("data-editor")||n.type,a=jdoo.searchEditors[i];if(!a)throw new Error("找不到编辑器:"+i);me.editors[t]=new a({dom:e,field:n,model:me.model,module:me.module,allowNull:!0,op:e.attr("data-op"),criteria:e.attr("data-criteria"),label:e.attr("data-label")})})),me.reset()},_updateCriteria:function(){let e=this;e.query={},e.body.empty(),$.each(e._fields,(function(t,n){let i=e.editors[n],a=i.getCriteria();if(i.criteria){let e=i.getValue();if(i.getRawVal&&(e=i.getRawValue()),e){let t=decodeURI(i.criteria);a=new Function("value","return "+t+";")(e)}}a.length>0&&e.add(n,i.label,i.getText(),a)}))},reset:function(){let e=this;$.each(e._fields,(function(t,n){e.editors[n].setValue("")})),e.dropdown.find("[data-default]").each((function(){let t=$(this),n=t.attr("data-default"),i=t.attr("data-field");e.editors[i].setValue(n)})),e._updateCriteria()},add:function(e,t,n,i){let a=this;a.query[e]=i;let o=`\n            <li class="jsearch-choice"  data-field="${e}">\n                <p class="filter-name">${t}</p>\n                <p class="filter-value"><span>${n}</span><span class="jsearch-choice-remove" role="presentation"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512"><path d="M256 48C141.31 48 48 141.31 48 256s93.31 208 208 208s208-93.31 208-208S370.69 48 256 48zm75.31 260.69a16 16 0 1 1-22.62 22.62L256 278.63l-52.69 52.68a16 16 0 0 1-22.62-22.62L233.37 256l-52.68-52.69a16 16 0 0 1 22.62-22.62L256 233.37l52.69-52.68a16 16 0 0 1 22.62 22.62L278.63 256z" fill="currentColor"></path></svg></span></p>\n            </li>\n        `;a.body.append(o);let l=a.body.find("[data-field="+e+"]");l.on("click",(function(e){e.stopPropagation()})),l.find(".jsearch-choice-remove").on("click",(function(t){a.remove(e),a.dom.triggerHandler("submitting",[a]),t.stopPropagation()}))},remove:function(e){let t=this;delete t.query[e],t.editors[e].setValue(""),t.body.find("[data-field="+e+"]").remove()},setCriteria:function(){},getCriteria:function(){let e=this,t=[],n=Object.values(e.query);return $.each(n,(function(){$.each(this,(function(){t.push(this)}))})),e.criteria&&$.each(e.criteria,(function(){t.push(this)})),e.panel&&$.each(e.panel.getCriteria(),(function(){t.push(this)})),t}})},475:()=>{$.component("JSearchPanel",{limit:1e3,presentField:"present",parentField:"parent_id",idField:"id",config:function(e){},getTpl:function(){return`<div class="search-panel">\n                    <label class="ml-2 mt-2 mb-0">${this.label}</label>\n                    <div id="search_panel_${jdoo.nextId()}" class="ztree"></div>\n                </div>`},init:function(){let me=this;if(me.sel=[],me._fields=[],me._fields.push(me.presentField),me.arch){let arch=jdoo.utils.parseXML(me.arch).children("searchpanel"),el=arch.find("field:first-child"),name=el.attr("name"),field=me.fields[name];if("many2one"!==field.type)throw new Error("searchpanel not support："+field.type);me.label=el.attr("label")||field.label,me.field=field,me.isTree=Boolean(eval(arch.attr("tree"))),me.select=eval(el.attr("select"))||[],me.isTree&&me._fields.push(me.parentField),me.dom.html(me.getTpl()),me.ztreeSetting={view:{showIcon:!1,selectedMulti:!1},data:{simpleData:{enable:!0,pIdKey:"parent_id"},key:{name:"present"}},callback:{onClick:function(e,t,n){me.sel=me.ztree.getSelectedNodes(),me.dom.triggerHandler("selected",[me,me.sel])}}},me.ztreeSetting.view.showLine=me.isTree,me.config(me.ztreeSetting)}me.onSelected(me.selected)},load:function(){let e=this;e.ajax(e,(function(t){e.ztree=$.fn.zTree.init(e.dom.find(".ztree"),e.ztreeSetting,t),e.ztree.expandAll(!0)}))},onSelected:function(e){this.dom.on("selected",e)},getSelect:function(){return this.select},getCriteria:function(){let e=this.sel[0];return e&&"all"!=e.id?[[this.field.name,"=",e.id]]:[]},getFields:function(){return this._fields}})},832:()=>{$.component("JToolbar",{defaultButtons:"create|edit|delete",defaultButtonCss:"btn-info",buttonsTpl:{create:`<button name="create" class="btn-success" t-click="target.create()">${"创建".t()}</button>`,createChild:`<button name="createChild" auth="create" class="btn-success" t-enable="id" t-click="target.curView.createChild()">${"创建子".t()}</button>`,copy:`<button name="copy" ref="create" auth="create" t-enable="id" class="btn-success" t-click="target.copy()">${"复制".t()}</button>`,edit:`<button name="edit" auth="update" class="btn-info" t-enable="id" t-click="target.edit()">${"编辑".t()}</button>`,delete:`<button name="delete" ref="edit" t-enable="ids" class="btn-danger" t-click="target.delete()" confirm="${"确定删除?".t()}">${"删除".t()}</button>`,save:`<button name="save" auth="create|update" class="btn-info" t-click="target.save()">${"保存".t()}</button>`,saveAndNew:"",import:"",export:""},init:function(){let e=this,t=e.dom,n=jdoo.utils.parseXML(e.arch).find("toolbar");t.empty(),0!=n.length&&(n.prepend(e._getDefaultButtons(n.attr("buttons")||e.defaultButtons)),n.find("button").each((function(){let t=$(this),n=t.attr("name")||t.attr("service")||""+jdoo.nextId(),i=t.attr("auth")||n||"",a=t.attr("class"),o="@all"===e.auths;if(t.attr("auth",i),o||$.each(i.split("|"),(function(){if(e.auths.indexOf(this)>-1)return o=!0,!0})),o){t.hasClass("btn")||t.addClass("btn"),a&&-1!=a.indexOf("btn-")||t.addClass(e.defaultButtonCss);let i=t.attr("label")||"";t.append(i.t()),t.attr("name","btn_"+n),t.attr("type")||t.attr("type","button"),t.replaceWith('<div name="btn_'+n+'_group" class="btn-group mr-1">'+t.prop("outerHTML")+"</div>")}else t.replaceWith("")})),n.find("button[ref]").each((function(){let e=$(this),t=e.attr("ref"),i=n.find("div[name=btn_"+t+"_group]");if(i.length>0){e.attr("class","dropdown-item");let a=i.find("dropdown-menu");if(a.length>0)a.append(e.prop("outerHTML"));else{let n=i.find("button[name=btn_"+t+"]").attr("class");n=n.replace("disabled",""),i.append('<button type="button" class="'+n+' dropdown-toggle dropdown-icon" data-toggle="dropdown"> </button>'),i.append('<div class="dropdown-menu" role="menu">'+e.prop("outerHTML")+"</div>")}n.find("div[name="+e.attr("name")+"_group]").remove()}})),t.html(n.html()).off("click").on("click","button[service]",(function(){let e=$(this),t=e.attr("confirm");t?jdoo.msg.confirm({content:t,submit:function(){view.postSvc(e.attr("service"))}}):view.postSvc(e.attr("service"))})).on("click","button[click]",(function(){let t=$(this),n=t.attr("t-click"),i=t.attr("confirm");i?jdoo.msg.confirm({content:i,submit:function(){new Function("target",n)(e.target)}}):new Function("target",n)(e.target)})),e.update([]))},update:function(e){this.dom.find("button[t-enable]").each((function(){let t=$(this),n=t.attr("t-enable");if("id"===n)1!=e.length?t.attr("disabled",!0):t.attr("disabled",!1);else if("ids"===n)e.length>0?t.attr("disabled",!1):t.attr("disabled",!0);else{let i=!0;if(n.startsWith("ids:"))if(0==e.length)i=!1;else{n=n.substring(4);for(let t=0;t<e.length;t++){let a=e[t];if(a.__test_active=new Function("return "+n),!a.__test_active()){i=!1;break}}}else if(n.startsWith("id:")&&(n=n.substring(3)),1!==e.length)i=!1;else{let t=e[0];t.__test_active=new Function("return "+n),t.__test_active()||(i=!1)}i?t.attr("disabled",!1):t.attr("disabled",!0)}}))},_getDefaultButtons:function(e){let t=this,n="",i=function(e){let i=t.buttonsTpl[e];i&&(n+=i)};return $.each(e.split("|"),(function(e,n){"default"===n&&$.each(t.defaultButtons.split("|"),(function(e,t){i(t)})),i(n)})),n}})},665:()=>{$.component("JTree",{presentField:"present",parentField:"parent_id",idField:"id",sortField:null,config:function(e){},ajax:function(e,t){},init:function(){let e=this;e.ztreeSetting={view:{showIcon:!1,selectedMulti:!1},edit:{enable:!0,drag:{},showRemoveBtn:!1,showRenameBtn:!1},data:{simpleData:{enable:!0,pIdKey:"parent_id"},key:{name:"present"}},callback:{onClick:function(t,n,i){let a=e.ztree.getSelectedNodes();e.dom.triggerHandler("selected",[e,a])}}},e.config(e.ztreeSetting),e.fields=[],e.fields.push(e.parentField),e.fields.push(e.presentField),e.sortField&&e.fields.push(e.sortField),e.dom.addClass("ztree"),e.onSelected(e.onselected)},onSelected:function(e){this.dom.on("selected",e)},load:function(){let e=this;e.ajax(e,(function(t){e.ztree=$.fn.zTree.init(e.dom,e.ztreeSetting,t),e.ztree.expandAll(!0);let n=jdoo.web.getParams(window.location.hash.substring(1)).id,i=e.ztree.getNodeByParam("id",n);i&&e.ztree.selectNode(i)}))},getFields:function(){return this.fields},expandSelected:function(){let e=this;if(e.ztree){let t=e.ztree.getSelectedNodes();t.length>0&&e.ztree.expandNode(t[0],!0,!0,!0)}},expandAll:function(){this.ztree&&this.ztree.expandAll(!0)},collapseSelected:function(){let e=this;if(e.ztree){let t=e.ztree.getSelectedNodes();t.length>0&&e.ztree.expandNode(t[0],!1,!0,!0)}},collapseAll:function(){this.ztree&&this.ztree.expandAll(!1)}})},745:()=>{$.component("JWebView",{icon:{grid:"fa-list-ul",card:"fa-th-large"},getViewTpl:function(){let e=this,t="";return $.each(e.viewtypes,(function(e,n){t+='<div role="'+n+'"></div>'})),`<div class="view-panel">\n                    <div class="header">\n                        <div class="content-header">\n                            <div class="container-fluid">\n                                <div role="search"></div>\n                            </div>\n                            <div class="btn-row">\n                                <div role="toolbar" class="toolbar"></div>\n                                <div class="btn-toolbar float-right toolbar-right">\n                                    <div role="pager" class="ml-2"></div>\n                                    <div role="view-type" class="ml-2">${function(){let t="";return e.viewtypes.length>1&&(t+='<div class="btn-group btn-group-toggle" data-toggle="buttons">',$.each(e.viewtypes,(function(n,i){let a=e.urlHash.viewtype===i||0===n;t+=`<label role="radio-view-type" data="${i}" class="btn btn-sm btn-secondary${a?" active":""}">\n                                        <input type="radio" name="options" autocomplete="off"${a?' checked="checked"':""}/>\n                                        <i class="fa ${e.icon[i]}"></i>\n                                    </label>`})),t+="</div>"),t}()}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="content">\n                        <aside role="search-panel" class="left-aside border-right" style="display:none"></aside>\n                        <div class="view-content container-fluid">${t}</div>\n                    </div>\n                </div>`},getFormTpl:function(){return'<div class="form-panel">\n                    <div class="content-header">\n                        <div class="btn-row">\n                            <div role="form-toolbar" class="toolbar"></div>\n                            <div class="btn-toolbar">\n                                <div role="data-nav" class="ml-2"></div>\n                                <div class="back"></div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="content">\n                        <div role="form" class="form-content">\n                        </div>\n                    </div>\n                </div>'},getTpl:function(){let e=this,t="";return e.viewtypes.length>0&&(t+=e.getViewTpl()),e.views.form&&(t+=e.getFormTpl()),e.views.custom&&(t+='<div class="custom-panel"></div>'),t},new:function(e){let t=this;jdoo.utils.apply(!0,t,e),$.event.trigger("viewLoaded",[t]),t.init(),t.render()},load:function(){let e=this;e.curView&&e.curView.load&&e.curView.load()},render:function(){let e=this;if(e.urlHash=jdoo.web.getParams(window.location.hash.substring(1)),e.viewtypes=e.urlHash.view.split(","),e.viewkey=e.urlHash.key,e.viewtypes.remove("form"),e.viewtypes.remove("custom"),e.dom.html(e.getTpl()).find("[role=radio-view-type]").on("click",(function(t){let n=$(this).attr("data");n!=e.viewtype&&e.changeView(n)})),e.viewtypes.length>0){if(!e.search){let t=function(){let t=e.dom.find(".view-panel .header").height();e.dom.find(".view-panel .content").css("height","calc(100% - "+t+"px)")};e.search=e.dom.find("[role=search]").JSearch({model:e.model,module:e.module,arch:e.views.search.arch,fields:e.fields,submitting:function(n,i){t(),e.pager.reset(),e.load()}}),t(),$(window).on("resize",(function(){t()}))}e.pager||(e.pager=e.dom.find("[role=pager]").JPager({limitChange:function(t,n){e.curView&&(e.curView.limit=n.limit)},pageChange:function(t,n){e.load()},counting:function(t,n){jdoo.rpc({model:e.model,module:e.module,method:"count",args:{criteria:e.search.getCriteria()},onsuccess:function(t){e.pager.update({total:t.data})}})}}))}e.data={},e.changeView(),e.dom.trigger("render",[e])},changeView:function(e){let t=this,n=e||t.urlHash.viewtype;!n&&t.urlHash.view&&(n=t.urlHash.view.split(",")[0]),t.viewtype!==n&&("grid"===n?t.showGridView():"card"===n?t.showCardView():"form"===n?t.showForm():"custom"===n&&t.showCustom(),t.viewtype=n,t.urlHash.viewtype=t.viewtype,t.dom.trigger("viewChanged",[t.viewtype,t])),t.updateHash()},updateHash:function(){window.location.hash=$.param(this.urlHash);let e=jdoo.web.getParams(top.window.location.hash.substring(1));e.u&&(e.u=window.location.pathname+"#"+$.param($.extend($.param(unescape(e.u)),this.urlHash))),top.window.location.hash=$.param(e)},showGridView:function(){let e=this;e.grid?(e.pager.limit=e.grid.limit,e.grid.load()):(e.grid=e.dom.find("[role=grid]").JGrid({model:e.model,module:e.module,arch:e.views.grid.arch,fields:e.fields,search:e.search,pager:e.pager,rowDblClick:function(t,n,i){e.urlHash.id=i,e.changeView("form")},selected:function(t,n,i){let a=[];$.each(i,(function(t,n){a.push(e.data[n])})),e.toolbar&&e.toolbar.update(a)},ajax:function(t,n,i,a){jdoo.rpc({model:e.model,module:e.module,method:"search",args:{criteria:e.search.getCriteria(),nextTest:!0,offset:e.pager.getOffest(),limit:e.pager.getLimit(),fields:t.getFields(),order:t.getSort()},context:{usePresent:!0},onsuccess:function(t){if(t.data.values.length>0){let n=e.pager.getOffest()+t.data.values.length;!1===t.data.hasNext?e.pager.update({to:n,next:!1,total:n}):e.pager.update({to:n,next:!0})}else e.pager.hide();n({data:t.data.values}),e.data={},$.each(t.data.values,(function(t,n){e.data[n.id]=n}))}})}}),e.dom.trigger("viewCreated",["grid",e])),e.toolbar=e.dom.find("[role=toolbar]").JToolbar({arch:e.grid.tbarArch,auths:e.auths,defaultButtons:"create|edit|delete|export",target:e}),e.curView=e.grid,e.showView("grid")},showCardView:function(){let e=this;e.card?(e.pager.limit=e.card.limit,e.card.load()):(e.card=e.dom.find("[role=card]").JCard({model:e.model,module:e.module,arch:e.views.card.arch,fields:e.fields,search:e.search,pager:e.pager,dblClick:function(t,n){e.urlHash.id=n,e.changeView("form")},selected:function(t,n,i){let a=[];$.each(i,(function(t,n){a.push(e.data[n])})),e.toolbar&&e.toolbar.update(a)},ajax:function(t,n){jdoo.rpc({model:e.model,module:e.module,method:"search",args:{criteria:e.search.getCriteria(),nextTest:!0,offset:e.pager.getOffest(),limit:e.pager.getLimit(),fields:t.getFields()},context:{usePresent:!0},onsuccess:function(t){if(t.data.values.length>0){let n=e.pager.getOffest()+t.data.values.length;!1===t.data.hasNext?e.pager.update({to:n,next:!1,total:n}):e.pager.update({to:n,next:!0})}else e.pager.hide();n({data:t.data.values}),e.data={},$.each(t.data.values,(function(t,n){e.data[n.id]=n}))}})}}),e.dom.trigger("viewCreated",["card",e])),e.toolbar=e.dom.find("[role=toolbar]").JToolbar({arch:e.card.tbarArch,auths:e.auths,defaultButtons:"create|edit|delete|export",target:e}),e.curView=e.card,e.showView("card")},showView:function(e){let t=this;t.dom.find(".form-panel,.custom-panel").hide(),t.dom.find(".view-panel").show(),$.each(t.viewtypes,(function(e,n){t.dom.find("[role="+n+"]").hide()})),t.dom.find("[role="+e+"]").show()},showCustom:function(){let e=this;e.custom||(e.custom=e.dom.find(".custom-panel").JCustom({model:e.model,module:e.module,arch:e.views.custom.arch,fields:e.fields}),e.dom.trigger("viewCreated",["custom",e])),e.curView=e.custom,e.dom.find(".custom-panel").show(),e.dom.find(".view-panel,.form-panel").hide()},showForm:function(){let e=this,t=e.viewtype;e.form||(e.form=e.dom.find("[role=form]").JForm({arch:e.views.form.arch,model:e.model,module:e.module,fields:e.fields,treeSelected:function(t,n,i){e.toolbar&&e.toolbar.update(i)},selected:function(t,n,i){if(e.toolbar){let t=i.length>0?[n.getData()]:[];e.toolbar.update(t)}},ajax:function(t,n){e.urlHash.id?jdoo.rpc({model:e.model,module:e.module,method:"read",args:{ids:[e.urlHash.id],fields:e.form.getFields()},context:{usePresent:!0},onsuccess:function(e){n({data:e.data[0]})}}):n({data:{}})}}),e.viewtypes.length>0&&(e.dom.find(".form-panel .back").append(`<button role="form-close" class="btn" type="button" >${"返回".t()}</button>`),e.dom.find("[role=form-close]").on("click",(function(){e.changeView(t||e.urlHash.view.split(",")[0])}))),e.dom.trigger("viewCreated",["form",e])),e.toolbar=e.dom.find("[role=form-toolbar]").JToolbar({arch:e.form.tbarArch,auths:e.auths,defaultButtons:e.form.isTree?"create|createChild|save|delete":"create|save",target:e}),e.curView=e.form,e.dom.find(".form-panel").show(),e.dom.find(".view-panel,.custom-panel").hide(),e.form.load()},getSelected:function(){return this.curView.getSelected()},save:function(){let e=this;if(null!=e.curView){if(!e.curView.valid())return;e.busy(!0),e.urlHash.id?jdoo.rpc({model:e.model,module:e.module,method:"update",args:{ids:[e.urlHash.id],values:e.curView.getDirtyData()},onerror:function(t){e.busy(!1),jdoo.msg.error(t)},onsuccess:function(t){e.busy(!1),jdoo.msg.show("保存成功".t()),e.load()}}):jdoo.rpc({model:e.model,module:e.module,method:"create",args:e.curView.getData(),onerror:function(t){e.busy(!1),jdoo.msg.error(t)},onsuccess:function(t){e.urlHash.id=t.data,e.busy(!1),jdoo.msg.show("保存成功".t()),window.location.hash=$.param(e.urlHash),e.load()}})}},busy:function(e){e?($(document.body).append(`<div id="pageWaitingModal" class="modal" data-keyboard="false" data-backdrop="static" data-role="dialog" aria-labelledby="pageWaitingModalLabel" aria-hidden="true">\n                                        <div id="loading" class="loading">${"加载中,请稍等".t()}</div>\n                                    </div>`),$("#pageWaitingModal").modal("show")):$("#pageWaitingModal").modal("hide").remove()},delete:function(){let e=this;jdoo.rpc({model:e.model,module:e.module,method:"delete",args:{ids:e.getSelected()},onsuccess:function(t){jdoo.msg.show("删除成功".t()),delete e.urlHash.id,e.load()}})},edit:function(){let e=this;e.urlHash.id=e.getSelected()[0],e.changeView("form")},create:function(){let e=this;delete e.urlHash.id,e.changeView("form"),e.form.create()},copy:function(){let e=this,t=e.getSelected();e.busy(!0),delete e.urlHash.id,e.changeView("form"),jdoo.rpc({model:e.model,module:e.module,method:"copy",args:{ids:t},onerror:function(t){e.busy(!1),jdoo.msg.error(t)},onsuccess:function(t){e.urlHash.id=t.data[0],e.busy(!1),jdoo.msg.show("保存成功".t()),window.location.hash=$.param(e.urlHash),e.form.load()}})},postSvc:function(svc,ids){let me=this;ids||(ids=me.getSelected()),me.busy(!0),jdoo.rpc({model:me.model,module:me.module,method:svc,args:{ids},onerror:function(e){me.busy(!1),jdoo.msg.error(e)},onsuccess:function(r){me.busy(!1);let d=r.data||{};d.message&&jdoo.msg.show(d.message),"js"===d.action?eval(d.script):"reload"===d.action?me.load():"service"===d.action||"dialog"===d.action||d.action}})}}),window.loadWebView=function(){let e=jdoo.web.getParams(window.location.hash.substring(1));jdoo.rpc({model:"ir.ui.view",method:"loadView",args:{model:e.model,type:e.view,key:e.key},onsuccess:function(e){e.data.resource&&$("head").append(e.data.resource),window.view=$("body").JWebView(e.data)}})},$((function(){loadWebView(),window.history&&window.history.pushState&&$(window).on("popstate",(function(){window.view&&(window.view.urlHash=jdoo.web.getParams(window.location.hash.substring(1)),window.view.changeView())})),$("html,body").css("height","100%"),$(document).on("click",(function(){top.window.$(".dropdown-menu").removeClass("show")}))}))},513:()=>{jdoo.define("JComponent",{new:function(e){let t=this;void 0===e&&(e={});let n=e.on;if(delete e.on,jdoo.utils.apply(!0,t,e),n)for(let e in n){let i=n[e];"function"==typeof i?t.on(e,i):i.selector&&t.on(e,i.selector,i.fn)}t.init()},init:jdoo.emptyFn,on:function(){let e=this,t=e.dom||$("body");return t.on(...arguments),e}}),jdoo.component=function(e,t){return"function"==typeof t&&(t=t()),t.extends=t.extends||"JComponent",jdoo.define(e,t)},$.component=function(e,t){let n=jdoo.component(e,t);return $.fn[e]=function(e){return new n($.extend({dom:this},e))},n}},858:()=>{jdoo.define("JDialog",{id:"dialog-id",title:"对话框".t(),submitText:"确定".t(),cancelText:"关闭".t(),loadingText:"加载中".t(),css:"modal-xl",getTpl:function(){return`<div class="modal fade" id="${this.id}">\n                    <div class="modal-dialog ${this.css}">\n                        <div class="modal-content">\n                        <div class="modal-header">\n                            <h4 class="modal-title">${this.title}</h4>\n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                            <span aria-hidden="true">&times;</span>\n                            </button>\n                        </div>\n                        <div class="modal-body">\n                            <p>${this.loadingText}</p>                        </div>\n                        <div class="modal-footer justify-content-between">\n                            <button type="button" class="btn btn-default" data-dismiss="modal">${this.cancelText}</button>\n                            <button type="button" role="btn-submit" class="btn btn-primary">${this.submitText}</button>\n                        </div>\n                        </div>\n                    </div>\n                </div>`},new:function(e){let t=this;jdoo.utils.apply(!0,t,e),$("#"+t.id).remove(),$(document.body).append(t.getTpl()),t.dom=$("#"+t.id).modal({backdrop:!1}),t.body=t.dom.find(".modal-body"),t.submit?t.dom.on("click","[role=btn-submit]",(function(){t.submit(t)&&t.dom.remove()})):t.dom.find("[role=btn-submit]").hide(),t.init(t)},init:jdoo.emptyFn,updateTitle:function(e){this.dom.find(".modal-title").html(e)},busy:function(e){e?this.dom.find("[role=btn-submit]").html("请稍等".t()).attr("disabled",!0):this.dom.find("[role=btn-submit]").html(this.submitText).attr("disabled",!1)},close:function(){this.dom.remove()}}),jdoo.showDialog=function(e){jdoo.create("JDialog",e)}},420:()=>{$.component("JTabs",{scrollOffset:40,contextMenu:!1,getTpl:function(){return'<div class="tab-panel">\n                    <div class="tab-header">\n                        <span role="button" style="display:none" class="nav-link bg-light border-bottom" data-widget="tab-scrollleft">\n                            <span class="fas fa-angle-double-left"></span>\n                        </span>\n                        <ul class="nav nav-tabs overflow-hidden" role="tablist"></ul>\n                        <span role="button" style="display:none" class="nav-link bg-light border-bottom" data-widget="tab-scrollright">\n                            <span class="fas fa-angle-double-right"></span>\n                        </span>\n                    </div>\n                    <div class="tab-content"></div>\n                </div>'},init:function(){let e=this,t=!1,n=null;e.dom.html(e.getTpl()).on("tabActived",e.tabActived).on("tabCreated",e.tabCreated).on("tabRemoved",e.tabRemoved).on("click",".nav-item-close",(function(){e.removeTab($(this).parent().attr("data"))})).on("click","[role=tab]",(function(){let t=$(this);e.dom.triggerHandler("tabActived",[e,t])})).on("mousedown","[data-widget=tab-scrollleft]",(function(i){i.preventDefault(),clearInterval(n);let a=-e.scrollOffset;t=!0,e._navScroll(a),n=setInterval((function(){e._navScroll(a)}),250)})).on("mousedown","[data-widget=tab-scrollright]",(function(i){i.preventDefault(),clearInterval(n);let a=e.scrollOffset;t=!0,e._navScroll(a),n=setInterval((function(){e._navScroll(a)}),250)})).on("mouseup",(function(){t&&(t=!1,clearInterval(n),n=null)})),$(window).on("resize",(function(){e.updateScroll()})),e.updateScroll()},_navScroll:function(e){let t=this.dom.find("[role=tablist]").scrollLeft();this.dom.find("[role=tablist]").animate({scrollLeft:t+e},250,"linear")},updateScroll:function(){let e=this,t=e.dom.find("[role=tablist]"),n=0;t.children("li").each((function(){n+=$(this).width()})),n>t.width()?e.dom.find("[data-widget=tab-scrollleft],[data-widget=tab-scrollright]").show():e.dom.find("[data-widget=tab-scrollleft],[data-widget=tab-scrollright]").hide()},openTab:function(e,t){let n=this,i="tab-"+e,a="tabcontent-"+e,o=n.dom.find("#"+i);if(o.length>0)o.hasClass("active")||(n.dom.find("[role=tab]").removeClass("active"),n.dom.find("[role=tabpanel]").removeClass("show active"),o.addClass("active"),n.dom.find("#"+a).addClass("show active"),n.dom.triggerHandler("tabActived",[n,o]));else{n.dom.find("[role=tab]").removeClass("active"),n.dom.find("[role=tabpanel]").removeClass("show active");let l='<li data="'+e+'" class="nav-item">';t.closable&&(l+='<a role="button" class="nav-item-close"><i class="fas fa-times"></i></a>'),l+='<a class="nav-link active" id="'+i+'" data-toggle="pill" href="#'+a+'" role="tab" aria-controls="'+a+'" aria-selected="true">'+t.title+"</a></li>",n.dom.find("[role=tablist]").append(l),n.dom.find(".tab-content").append('<div class="tab-pane fade show active" id="'+a+'" role="tabpanel" aria-labelledby="'+i+'"></div>'),t.init&&t.init(n.dom.find("#"+a)),o=n.dom.find("#"+i),n.dom.triggerHandler("tabCreated",[n,o]),n.dom.triggerHandler("tabActived",[n,o]),n.contextMenu&&n.initTabMenu(e),n.updateScroll()}},updateTab:function(e,t){this.dom.find("#tab-"+e).html(t),this.updateScroll()},removeTab:function(e){let t=this;t.dom.find("[data="+e+"]").remove(),t.dom.find("#tabcontent-"+e).remove(),t.dom.triggerHandler("tabRemoved",[t,e]);let n=t.dom.find("[role=tab].active");0==n.length&&(n=t.dom.find("[role=tab]:first").addClass("active"),t.dom.find("#"+n.attr("aria-controls")).addClass("show active"),t.dom.triggerHandler("tabActived",[t,n])),t.updateScroll()},removeOtherTab:function(e){let t=this;t.dom.find("li:not([data="+e+"])").remove(),t.dom.find(".tab-pane:not(#tabcontent-"+e+")").remove(),t.dom.triggerHandler("tabRemoved",[t]);let n=t.dom.find("#tab-"+e);n.hasClass("active")||(n.addClass("active"),t.dom.find("#"+n.attr("aria-controls")).addClass("show active"),t.dom.triggerHandler("tabActived",[t,n])),t.updateScroll()},onTabActived:function(e){this.dom.on("tabActived",e)},onTabCreated:function(e){this.dom.on("tabCreated",e)},onTabRemoved:function(e){this.dom.on("tabRemoved",e)},enableTab:function(e,t){},initTabMenu:function(e){let t=this;t.dom.find("[data="+e+"]").contextMenu({width:110,itemHeight:30,autoHide:!0,bgColor:"#fff",color:"#0000",fontSize:12,hoverColor:"#ffff",hoverBgColor:"#32c5d2",menu:[{text:"关闭当前".t(),callback:function(){t.removeTab(e)}},{text:"关闭其他".t(),callback:function(){t.removeOtherTab(e)}}]})}})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{"use strict";__webpack_require__(513),__webpack_require__(858),__webpack_require__(420),__webpack_require__(655),__webpack_require__(376),__webpack_require__(716),__webpack_require__(570),__webpack_require__(934),__webpack_require__(590),__webpack_require__(329),__webpack_require__(546),__webpack_require__(87),__webpack_require__(161),__webpack_require__(583),__webpack_require__(629),__webpack_require__(892),__webpack_require__(977),__webpack_require__(639),__webpack_require__(285),__webpack_require__(255),__webpack_require__(96),__webpack_require__(26),__webpack_require__(648),__webpack_require__(187),__webpack_require__(286),__webpack_require__(636),__webpack_require__(141),__webpack_require__(834),__webpack_require__(416),__webpack_require__(663),__webpack_require__(475),__webpack_require__(212),__webpack_require__(411),__webpack_require__(832),__webpack_require__(337),__webpack_require__(553),__webpack_require__(364),__webpack_require__(665),__webpack_require__(739),__webpack_require__(745)})()})();